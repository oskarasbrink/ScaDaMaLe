<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>031a_MagellanOSMIngestion - sds-3.x/ScaDaMaLe</title>


        <!-- Custom HTML head -->

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../scroll-mdbook-outputs.css">

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/000_5-sds-2-x-geo-changes.html">000_5-sds-2-x-geo-changes</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/001_CrashCourseGIS.html">001_CrashCourseGIS</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/031_GeospatialAnalyticsInMagellan.html">031_GeospatialAnalyticsInMagellan</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/031a_MagellanOSMIngestion.html" class="active">031a_MagellanOSMIngestion</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/032_NYtaxisInMagellan.html">032_NYtaxisInMagellan</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/032a_MSR_BeijingTaxiTrajectories_MagellanQueries.html">032a_MSR_BeijingTaxiTrajectories_MagellanQueries</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/032b_UberMapMatchingAndVisualization.html">032b_UberMapMatchingAndVisualization</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/032d_MobileSampleSQL.html">032d_MobileSampleSQL</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/032e_CallDetailRecords.html">032e_CallDetailRecords</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/032x_ComingAttractions.html">032x_ComingAttractions</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/033_00_Intro2PointsOnGraphs.html">033_00_Intro2PointsOnGraphs</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/033_01_OSMtoGraphXUppsalaTiny.html">033_01_OSMtoGraphXUppsalaTiny</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/033_02_OSMtoGraphX_LT.html">033_02_OSMtoGraphX_LT</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/033_03_LT_PageRank.html">033_03_LT_PageRank</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/034_01_MapMatching_with_GeoMatch_UppsalaTiny.html">034_01_MapMatching_with_GeoMatch_UppsalaTiny</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/034_02_MapMatching_on_a_Graph_UppsalaTiny.html">034_02_MapMatching_on_a_Graph_UppsalaTiny</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/034_03_MapMatching_on_a_Graph_LT.html">034_03_MapMatching_on_a_Graph_LT</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/034_04_MapMatching_on_a_G1_LT.html">034_04_MapMatching_on_a_G1_LT</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/034_05DistributionOfStates.html">034_05DistributionOfStates</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/034_06SimulatingArrivalTimesNHPP_Inversion.html">034_06SimulatingArrivalTimesNHPP_Inversion</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/035_01_Arcgis_coordinates_transformation.html">035_01_Arcgis_coordinates_transformation</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/035_02_Segmentation_municipalities_Magellan.html">035_02_Segmentation_municipalities_Magellan</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/035_03_Visualization_municipalities.html">035_03_Visualization_municipalities</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/035_04_MapMatching_intersections.html">035_04_MapMatching_intersections</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/035_05_UndirectedG0.html">035_05_UndirectedG0</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/035_06_ConnectedComponent_PageRank.html">035_06_ConnectedComponent_PageRank</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_5-sds-2-x-geo/035_07_PoissonRegression.html">035_07_PoissonRegression</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">sds-3.x/ScaDaMaLe</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div class="cell markdown">
<p>ScaDaMaLe Course <a href="https://lamastex.github.io/scalable-data-science/sds/3/x/">site</a> and <a href="https://lamastex.github.io/ScaDaMaLe/index.html">book</a></p>
</div>
<div class="cell markdown">
<p>By <a href="https://www.linkedin.com/in/marina-toger-29030320/">Marina Toger</a></p>
<p>TODO: Raaz - re-liven for 2021...</p>
</div>
<div class="cell markdown">
<h3 id="osm"><a class="header" href="#osm">OSM</a></h3>
<p>1.We define an area of interest and find coordinates of its boundary, AKA &quot;bounding box&quot;. To do this go to https://www.openstreetmap.org and zoom roughly into the desired area. Then one can see the coordinates of the bounding box by using the export option.</p>
<p>2.To ingest data from OSM we use <code>wget</code>, in the following format:</p>
<p><code>wget -O MyFileName.osm &quot;https://api.openstreetmap.org/api/0.6/map?bbox=l,b,r,t&quot;</code></p>
<ul>
<li>
<p><code>MyFileName.osm</code> - give some informative file name</p>
</li>
<li>
<p>l = longitude of the LEFT boundary of the bounding box</p>
</li>
<li>
<p>b = lattitude of the BOTTOM boundary of the bounding box</p>
</li>
<li>
<p>r = longitude of the RIGHT boundary of the bounding box</p>
</li>
<li>
<p>t = lattitude of the TOP boundary of the bounding box</p>
</li>
</ul>
<p>For instance if you know the bounding box, do:</p>
<ul>
<li>
<p><code>TinyUppsalaCentrumWgot.osm</code> - Tiny area in Uppsala Centrum</p>
</li>
<li>
<p>l = <code>17.63514</code></p>
</li>
<li>
<p>b = <code>59.85739</code></p>
</li>
<li>
<p>r = <code>17.64154</code></p>
</li>
<li>
<p>t = <code>59.86011</code></p>
</li>
</ul>
<!-- -->
<pre><code>wget -O TinyUppsalaCentrumWgot.osm &quot;https://api.openstreetmap.org/api/0.6/map?bbox=17.63514,59.85739,17.64154,59.86011&quot;
</code></pre>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">//Imports
import magellan._
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>import magellan._
</code></pre>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-sh">ls
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>conf
derby.log
eventlogs
ganglia
logs
</code></pre>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="true">
<pre><code class="language-sh">wget -O UppsalaCentrumWgot.osm &quot;https://api.openstreetmap.org/api/0.6/map?bbox=17.6244,59.8464,17.6661,59.8643&quot;
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>--2022-02-01 14:26:09--  https://api.openstreetmap.org/api/0.6/map?bbox=17.6244,59.8464,17.6661,59.8643
Resolving api.openstreetmap.org (api.openstreetmap.org)... 130.117.76.11, 130.117.76.12, 130.117.76.13, ...
Connecting to api.openstreetmap.org (api.openstreetmap.org)|130.117.76.11|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: unspecified [application/xml]
Saving to: ‘UppsalaCentrumWgot.osm’

     0K .......... .......... .......... .......... .......... 1.23M
    50K .......... .......... .......... .......... .......... 2.79M
   100K .......... .......... .......... .......... .......... 2.88M
   150K .......... .......... .......... .......... .......... 2.72M
   200K .......... .......... .......... .......... .......... 3.79M
   250K .......... .......... .......... .......... .......... 3.11M
   300K .......... .......... .......... .......... .......... 3.30M
   350K .......... .......... .......... .......... .......... 3.02M
   400K .......... .......... .......... .......... .......... 3.75M
   450K .......... .......... .......... .......... .......... 4.69M
   500K .......... .......... .......... .......... .......... 3.50M
   550K .......... .......... .......... .......... .......... 3.64M
   600K .......... .......... .......... .......... .......... 4.86M
   650K .......... .......... .......... .......... .......... 4.01M
   700K .......... .......... .......... .......... .......... 5.28M
   750K .......... .......... .......... .......... .......... 3.93M
   800K .......... .......... .......... .......... .......... 4.48M
   850K .......... .......... .......... .......... .......... 4.95M
   900K .......... .......... .......... .......... .......... 4.80M
   950K .......... .......... .......... .......... .......... 5.27M
  1000K .......... .......... .......... .......... .......... 5.10M
  1050K .......... .......... .......... .......... .......... 5.59M
  1100K .......... .......... .......... .......... .......... 5.48M
  1150K .......... .......... .......... .......... .......... 5.24M
  1200K .......... .......... .......... .......... .......... 5.40M
  1250K .......... .......... .......... .......... .......... 5.69M
  1300K .......... .......... .......... .......... .......... 5.11M
  1350K .......... .......... .......... .......... .......... 6.30M
  1400K .......... .......... .......... .......... .......... 4.97M
  1450K .......... .......... .......... .......... .......... 7.48M
  1500K .......... .......... .......... .......... .......... 8.73M
  1550K .......... .......... .......... .......... .......... 4.89M
  1600K .......... .......... .......... .......... .......... 7.32M
  1650K .......... .......... .......... .......... .......... 5.84M
  1700K .......... .......... .......... .......... .......... 8.32M
  1750K .......... .......... .......... .......... .......... 7.74M
  1800K .......... .......... .......... .......... .......... 5.71M
  1850K .......... .......... .......... .......... .......... 9.01M
  1900K .......... .......... .......... .......... .......... 7.35M
  1950K .......... .......... .......... .......... .......... 6.41M
  2000K .......... .......... .......... .......... .......... 8.13M
  2050K .......... .......... .......... .......... .......... 10.5M
  2100K .......... .......... .......... .......... .......... 5.47M
  2150K .......... .......... .......... .......... .......... 9.04M
  2200K .......... .......... .......... .......... .......... 6.53M
  2250K .......... .......... .......... .......... .......... 10.6M
  2300K .......... .......... .......... .......... .......... 8.93M
  2350K .......... .......... .......... .......... .......... 5.99M
  2400K .......... .......... .......... .......... .......... 13.1M
  2450K .......... .......... .......... .......... .......... 10.6M
  2500K .......... .......... .......... .......... .......... 9.44M
  2550K .......... .......... .......... .......... .......... 6.36M
  2600K .......... .......... .......... .......... .......... 12.4M
  2650K .......... .......... .......... .......... .......... 9.65M
  2700K .......... .......... .......... .......... .......... 2.68M
  2750K .......... .......... .......... .......... .......... 13.4M
  2800K .......... .......... .......... .......... .......... 16.5M
  2850K .......... .......... .......... .......... .......... 24.9M
  2900K .......... .......... .......... .......... .......... 4.71M
  2950K .......... .......... .......... .......... .......... 12.2M
  3000K .......... .......... .......... .......... .......... 12.5M
  3050K .......... .......... .......... .......... .......... 11.6M
  3100K .......... .......... .......... .......... .......... 7.08M
  3150K .......... .......... .......... .......... .......... 11.0M
  3200K .......... .......... .......... .......... .......... 15.9M
  3250K .......... .......... .......... .......... .......... 11.6M
  3300K .......... .......... .......... .......... .......... 7.41M
  3350K .......... .......... .......... .......... .......... 13.2M
  3400K .......... .......... .......... .......... .......... 13.5M
  3450K .......... .......... .......... .......... .......... 11.9M
  3500K .......... .......... .......... .......... .......... 7.33M
  3550K .......... .......... .......... .......... .......... 14.2M
  3600K .......... .......... .......... .......... .......... 17.1M
  3650K .......... .......... .......... .......... .......... 14.6M
  3700K .......... .......... .......... .......... .......... 10.6M
  3750K .......... .......... .......... .......... .......... 8.35M
  3800K .......... .......... .......... .......... .......... 13.2M
  3850K .......... .......... .......... .......... .......... 14.9M
  3900K .......... .......... .......... .......... .......... 12.9M
  3950K .......... .......... .......... .......... .......... 8.15M
  4000K .......... .......... .......... .......... .......... 15.2M
  4050K .......... .......... .......... .......... .......... 15.5M
  4100K .......... .......... .......... .......... .......... 15.6M
  4150K .......... .......... .......... .......... .......... 13.6M
  4200K .......... .......... .......... .......... .......... 8.86M
  4250K .......... .......... .......... .......... .......... 12.3M
  4300K .......... .......... .......... .......... .......... 16.8M
  4350K .......... .......... .......... .......... .......... 17.4M
  4400K .......... .......... .......... .......... .......... 14.9M
  4450K .......... .......... .......... .......... .......... 8.28M
  4500K .......... .......... .......... .......... .......... 16.9M
  4550K .......... .......... .......... .......... .......... 16.5M
  4600K .......... .......... .......... .......... .......... 20.1M
  4650K .......... .......... .......... .......... .......... 12.2M
  4700K .......... .......... .......... .......... .......... 6.99M
  4750K .......... .......... .......... .......... .......... 27.3M
  4800K .......... .......... .......... .......... .......... 24.5M
  4850K .......... .......... .......... .......... .......... 10.7M
  4900K .......... .......... .......... .......... .......... 18.1M
  4950K .......... .......... .......... .......... .......... 22.1M
  5000K .......... .......... .......... .......... ..........  155K
  5050K .......... .......... .......... .......... .......... 15.3M
  5100K .......... .......... .......... .......... .......... 3.96M
  5150K .......... .......... .......... .......... .......... 12.0M
  5200K .......... .......... .......... .......... .......... 11.5M
  5250K .......... .......... .......... .......... .......... 12.9M
  5300K .......... .......... .......... .......... .......... 13.8M
  5350K .......... .......... .......... .......... .......... 9.31M
  5400K .......... .......... .......... .......... .......... 12.3M
  5450K .......... .......... .......... .......... .......... 10.9M
  5500K .......... .......... .......... .......... .......... 13.8M
  5550K .......... .......... .......... .......... .......... 11.5M
  5600K .......... .......... .......... .......... .......... 9.91M
  5650K .......... .......... .......... .......... .......... 13.7M
  5700K .......... .......... .......... .......... .......... 11.9M
  5750K .......... .......... .......... .......... .......... 19.8M
  5800K .......... .......... .......... .......... .......... 8.41M
  5850K .......... .......... .......... .......... .......... 13.2M
  5900K .......... .......... .......... .......... .......... 13.9M
  5950K .......... .......... .......... .......... .......... 14.9M
  6000K .......... .......... .......... .......... .......... 9.74M
  6050K .......... .......... .......... .......... .......... 10.4M
  6100K .......... .......... .......... .......... .......... 12.1M
  6150K .......... .......... .......... .......... .......... 10.5M
  6200K .......... .......... .......... .......... .......... 9.44M
  6250K .......... .......... .......... .......... .......... 9.99M
  6300K .......... .......... .......... .......... .......... 11.4M
  6350K .......... .......... .......... .......... .......... 11.3M
  6400K .......... .......... .......... .......... .......... 9.48M
  6450K .......... .......... .......... .......... .......... 11.2M
  6500K .......... .......... .......... .......... .......... 9.62M
  6550K .......... .......... .......... .......... .......... 11.3M
  6600K .......... .......... .......... .......... .......... 14.9M
  6650K .......... .......... .......... .......... .......... 14.6M
  6700K .......... .......... .......... .......... .......... 12.0M
  6750K .......... .......... .......... .......... .......... 10.8M
  6800K .......... .......... .......... .......... .......... 13.2M
  6850K .......... .......... .......... .......... .......... 17.8M
  6900K .......... .......... .......... .......... .......... 17.9M
  6950K .......... .......... .......... .......... .......... 17.0M
  7000K .......... .......... .......... .......... ..........  397K
  7050K .......... .......... .......... .......... .......... 18.6M
  7100K .......... .......... .......... .......... .......... 17.7M
  7150K .......... .......... .......... .......... .......... 18.6M
  7200K .......... .......... .......... .......... .......... 14.0M
  7250K .......... .......... .......... .......... .......... 7.73M
  7300K .......... .......... .......... .......... .......... 16.9M
  7350K .......... .......... .......... .......... .......... 24.0M
  7400K .......... .......... .......... .......... .......... 14.7M
  7450K .......... .......... .......... .......... .......... 19.6M
  7500K .......... .......... .......... .......... .......... 20.3M
  7550K .......... .......... .......... .......... .......... 8.28M
  7600K .......... .......... .......... .......... .......... 15.2M
  7650K .......... .......... .......... .......... .......... 27.7M
  7700K .......... .......... .......... .......... .......... 18.5M
  7750K .......... .......... .......... .......... .......... 19.0M
  7800K .......... .......... .......... .......... .......... 19.6M
  7850K .......... .......... .......... .......... .......... 8.47M
  7900K .......... .......... .......... .......... .......... 14.9M
  7950K .......... .......... .......... .......... .......... 27.5M
  8000K .......... .......... .......... .......... .......... 16.9M
  8050K .......... .......... .......... .......... .......... 19.6M
  8100K .......... .......... .......... .......... .......... 26.3M
  8150K .......... .......... .......... .......... .......... 3.38M
  8200K .......... .......... .......... .......... .......... 58.7M
  8250K .......... .......... .......... .......... .......... 89.1M
  8300K .......... .......... .......... .......... .......... 69.0M
  8350K .......... .......... .......... .......... .......... 63.6M
  8400K .......... .......... .......... .......... .......... 28.1M
  8450K .......... ...                                         46.9M=1.4s

2022-02-01 14:26:13 (5.79 MB/s) - ‘UppsalaCentrumWgot.osm’ saved [8667122]
</code></pre>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-sh">pwd
ls
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>/databricks/driver
conf
derby.log
eventlogs
ganglia
logs
</code></pre>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">display(dbutils.fs.ls(&quot;dbfs:///datasets/&quot;))
</code></pre>
<div class="output execute_result tabular_result" execution_count="1">
<table>
<thead>
<tr class="header">
<th>path</th>
<th>name</th>
<th>size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>dbfs:/datasets/alexandria/</td>
<td>alexandria/</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>dbfs:/datasets/beijing/</td>
<td>beijing/</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>dbfs:/datasets/magellan/</td>
<td>magellan/</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>dbfs:/datasets/maps/</td>
<td>maps/</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>dbfs:/datasets/mobile_sample/</td>
<td>mobile_sample/</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>dbfs:/datasets/osm/</td>
<td>osm/</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>dbfs:/datasets/sou/</td>
<td>sou/</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>dbfs:/datasets/t-drive-trips/</td>
<td>t-drive-trips/</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>dbfs:/datasets/t-drive-trips-magellan/</td>
<td>t-drive-trips-magellan/</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>dbfs:/datasets/taxis/</td>
<td>taxis/</td>
<td>0.0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">// making directory in distributed file system
dbutils.fs.mkdirs(&quot;dbfs:///datasets/maps/&quot;)
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>res1: Boolean = true
</code></pre>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">display(dbutils.fs.ls(&quot;dbfs:///datasets/maps/&quot;))
</code></pre>
<div class="output execute_result tabular_result" execution_count="1">
<table>
<thead>
<tr class="header">
<th>path</th>
<th>name</th>
<th>size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>dbfs:/datasets/maps/StockholmCentrumWgot.osm</td>
<td>StockholmCentrumWgot.osm</td>
<td>3820982.0</td>
</tr>
<tr class="even">
<td>dbfs:/datasets/maps/TinyUppsalaCentrumWgot.osm</td>
<td>TinyUppsalaCentrumWgot.osm</td>
<td>919097.0</td>
</tr>
<tr class="odd">
<td>dbfs:/datasets/maps/UppsalaCentrumWgot.osm</td>
<td>UppsalaCentrumWgot.osm</td>
<td>8667122.0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">// copy file from local fs to dbfs
dbutils.fs.cp(&quot;file:///databricks/driver/UppsalaCentrumWgot.osm&quot;,&quot;dbfs:///datasets/maps/&quot;)
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>res4: Boolean = true
</code></pre>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">display(dbutils.fs.ls(&quot;dbfs:///datasets/maps/&quot;))
</code></pre>
<div class="output execute_result tabular_result" execution_count="1">
<table>
<thead>
<tr class="header">
<th>path</th>
<th>name</th>
<th>size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>dbfs:/datasets/maps/StockholmCentrumWgot.osm</td>
<td>StockholmCentrumWgot.osm</td>
<td>3820982.0</td>
</tr>
<tr class="even">
<td>dbfs:/datasets/maps/TinyUppsalaCentrumWgot.osm</td>
<td>TinyUppsalaCentrumWgot.osm</td>
<td>919097.0</td>
</tr>
<tr class="odd">
<td>dbfs:/datasets/maps/UppsalaCentrumWgot.osm</td>
<td>UppsalaCentrumWgot.osm</td>
<td>8667122.0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">//Read the data from dbfs
val path = &quot;dbfs:/datasets/maps/UppsalaCentrumWgot.osm&quot;
val uppsalaCentrumOsmDF = spark.read
      .format(&quot;magellan&quot;)
      .option(&quot;type&quot;, &quot;osm&quot;)
      .load(path)
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>path: String = dbfs:/datasets/maps/UppsalaCentrumWgot.osm
uppsalaCentrumOsmDF: org.apache.spark.sql.DataFrame = [point: point, polyline: polyline ... 3 more fields]
</code></pre>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">uppsalaCentrumOsmDF.show()
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>+-----+--------------------+--------------------+--------------------+-----+
|point|            polyline|             polygon|            metadata|valid|
+-----+--------------------+--------------------+--------------------+-----+
| null|magellan.PolyLine...|                null|[electrified -&gt; c...| true|
| null|magellan.PolyLine...|                null|                  []| true|
| null|magellan.PolyLine...|                null|[electrified -&gt; c...| true|
| null|magellan.PolyLine...|                null|[electrified -&gt; c...| true|
| null|magellan.PolyLine...|                null|[electrified -&gt; c...| true|
| null|magellan.PolyLine...|                null|[electrified -&gt; c...| true|
| null|magellan.PolyLine...|                null|[electrified -&gt; c...| true|
| null|magellan.PolyLine...|                null|  [landuse -&gt; grass]| true|
| null|                null|magellan.Polygon@...|                  []| true|
| null|                null|magellan.Polygon@...|[natural -&gt; grass...| true|
| null|                null|magellan.Polygon@...|  [landuse -&gt; grass]| true|
| null|                null|magellan.Polygon@...|  [landuse -&gt; grass]| true|
| null|                null|magellan.Polygon@...|  [landuse -&gt; grass]| true|
| null|                null|magellan.Polygon@...|   [leisure -&gt; park]| true|
| null|magellan.PolyLine...|                null|[highway -&gt; cycle...| true|
| null|magellan.PolyLine...|                null|[leisure -&gt; park,...| true|
| null|magellan.PolyLine...|                null|[bicycle -&gt; desig...| true|
| null|magellan.PolyLine...|                null|[name -&gt; Bolandgy...| true|
| null|                null|magellan.Polygon@...|   [building -&gt; yes]| true|
| null|                null|magellan.Polygon@...|[electrified -&gt; n...| true|
+-----+--------------------+--------------------+--------------------+-----+
only showing top 20 rows
</code></pre>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">display(uppsalaCentrumOsmDF)
</code></pre>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">uppsalaCentrumOsmDF.count
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>res9: Long = 32112
</code></pre>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-sh">wget -O TinyUppsalaCentrumWgot.osm &quot;https://api.openstreetmap.org/api/0.6/map?bbox=17.63514,59.85739,17.64154,59.86011&quot;
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>--2022-02-02 08:56:29--  https://api.openstreetmap.org/api/0.6/map?bbox=17.63514,59.85739,17.64154,59.86011
Resolving api.openstreetmap.org (api.openstreetmap.org)... 130.117.76.13, 130.117.76.11, 130.117.76.12, ...
Connecting to api.openstreetmap.org (api.openstreetmap.org)|130.117.76.13|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: unspecified [application/xml]
Saving to: ‘TinyUppsalaCentrumWgot.osm’

     0K .......... .......... .......... .......... .......... 1.32M
    50K .......... .......... .......... .......... .......... 3.11M
   100K .......... .......... .......... .......... .......... 3.17M
   150K .......... .......... .......... .......... .......... 2.84M
   200K .......... .......... .......... .......... .......... 4.22M
   250K .......... .......... .......... .......... .......... 3.36M
   300K .......... .......... .......... .......... .......... 3.69M
   350K .......... .......... .......... .......... .......... 3.11M
   400K .......... .......... .......... .......... .......... 4.36M
   450K .......... .......... .......... .......... .......... 4.32M
   500K .......... .......... .......... .......... .......... 4.20M
   550K .......... .......... .......... .......... .......... 4.21M
   600K .......... .......... .......... .......... .......... 4.49M
   650K .......... .......... .......... .......... .......... 4.55M
   700K .......... .......... .......... .......... .......... 4.71M
   750K .......... .......... .......... .......... .......... 4.48M
   800K .......... .......... .......... .......... .......... 5.36M
   850K .......... .......... .......... .......... .......    5.78M=0.2s

2022-02-02 08:56:29 (3.56 MB/s) - ‘TinyUppsalaCentrumWgot.osm’ saved [919096]
</code></pre>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-sh">pwd
ls
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>/databricks/driver
TinyUppsalaCentrumWgot.osm
conf
derby.log
eventlogs
ganglia
logs
</code></pre>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">// copy file from local fs to dbfs
dbutils.fs.cp(&quot;file:///databricks/driver/TinyUppsalaCentrumWgot.osm&quot;,&quot;dbfs:///datasets/maps/&quot;)
display(dbutils.fs.ls(&quot;dbfs:///datasets/maps/&quot;))
</code></pre>
<div class="output execute_result tabular_result" execution_count="1">
<table>
<thead>
<tr class="header">
<th>path</th>
<th>name</th>
<th>size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>dbfs:/datasets/maps/StockholmCentrumWgot.osm</td>
<td>StockholmCentrumWgot.osm</td>
<td>3820982.0</td>
</tr>
<tr class="even">
<td>dbfs:/datasets/maps/TinyUppsalaCentrumWgot.osm</td>
<td>TinyUppsalaCentrumWgot.osm</td>
<td>919096.0</td>
</tr>
<tr class="odd">
<td>dbfs:/datasets/maps/UppsalaCentrumWgot.osm</td>
<td>UppsalaCentrumWgot.osm</td>
<td>8667122.0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">//read the file from dbfs
val path = &quot;dbfs:/datasets/maps/TinyUppsalaCentrumWgot.osm&quot;
val tinyUppsalaCentrumOsmDF = spark.read
      .format(&quot;magellan&quot;)
      .option(&quot;type&quot;, &quot;osm&quot;)
      .load(path)
display(tinyUppsalaCentrumOsmDF)
</code></pre>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">tinyUppsalaCentrumOsmDF.count
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>res12: Long = 1857
</code></pre>
</div>
</div>
<div class="cell markdown">
<h2 id="setting-up-leaflet"><a class="header" href="#setting-up-leaflet">Setting up leaflet</a></h2>
<p>You need to go to the following URL and set-up access-token in map-box to use leaflet independently:</p>
<ul>
<li>https://leafletjs.com/examples/quick-start/</li>
<li>Request access-token:
<ul>
<li>https://account.mapbox.com/auth/signin/?route-to=%22/access-tokens/%22</li>
</ul>
</li>
</ul>
</div>
<div class="cell markdown">
<h4 id="visualise-with-leaflet"><a class="header" href="#visualise-with-leaflet">Visualise with leaflet:</a></h4>
<p>Take an array of Strings in 'GeoJson' format, then insert this into a prebuild html string that contains all the code neccesary to display these features using Leaflet. The resulting html can be displayed in DataBricks using the displayHTML function.</p>
<p>See http://leafletjs.com/examples/geojson.html for a detailed example of using GeoJson with Leaflet.</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">//val point1 = sc.parallelize(Seq((59.839264, 17.647075),(59.9, 17.88))).toDF(&quot;x&quot;, &quot;y&quot;)
val point1 = sc.parallelize(Seq((59.839264, 17.647075))).toDF(&quot;x&quot;, &quot;y&quot;)
val point1c = point1.collect()
val string2 = point1c.mkString(&quot;,&quot;)
//df.select(columns: _*).collect.map(_.toSeq)
val string22 = &quot;'random_string'&quot;
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>point1: org.apache.spark.sql.DataFrame = [x: double, y: double]
point1c: Array[org.apache.spark.sql.Row] = Array([59.839264,17.647075])
string2: String = [59.839264,17.647075]
string22: String = 'random_string'
</code></pre>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="auto">
<pre><code class="language-scala">def genLeafletHTML(): String = {
  val accessToken = &quot;pk.eyJ1IjoiZHRnIiwiYSI6ImNpaWF6MGdiNDAwanNtemx6MmIyNXoyOWIifQ.ndbNtExCMXZHKyfNtEN0Vg&quot;

  val generatedHTML = f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;  
  &lt;html&gt;
  &lt;head&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css&quot;&gt;
        &lt;style&gt;#map {width: 600px; height:400px;}&lt;/style&gt;
  &lt;/head&gt;
  
  &lt;body&gt;
      &lt;div id=&quot;map&quot; style=&quot;width: 600px; height: 400px&quot;&gt;&lt;/div&gt;
      &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js&quot;&gt;&lt;/script&gt;
      &lt;script type=&quot;text/javascript&quot;&gt;
          var map = L.map('map').setView([59.838, 17.646865], 16);

          L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=$accessToken', {
            maxZoom: 19
            , id: 'mapbox.streets'
            , attribution: '&lt;a href=&quot;http://openstreetmap.org&quot;&gt;OpenStreetMap&lt;/a&gt; ' +
              '&lt;a href=&quot;http://creativecommons.org/licenses/by-sa/2.0/&quot;&gt;CC-BY-SA&lt;/a&gt; ' +
              '| &amp;copy; &lt;a href=&quot;http://mapbox.com&quot;&gt;Mapbox&lt;/a&gt;'
          }).addTo(map);
          
          str1 = 'SDS&lt;br&gt;Ångströmlaboratoriet&lt;br&gt;59.839264, 17.647075&lt;br&gt;';
          str2 = ${string22};
          var popup = str1.concat(str2);
          
          L.marker(${string2}).addTo(map)
              .bindPopup(popup)
              .openPopup();

      &lt;/script&gt;
  &lt;/body&gt;  
  &quot;&quot;&quot;
  generatedHTML
}

displayHTML(genLeafletHTML)
</code></pre>
<div class="output execute_result html_result" execution_count="1">
<!DOCTYPE html>  
<html>
  <head>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css">
        <style>#map {width: 600px; height:400px;}</style>
  </head>
<body>
      <div id="map" style="width: 600px; height: 400px"></div>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>
      <script type="text/javascript">
          var map = L.map('map').setView([59.838, 17.646865], 16);
<pre><code>      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZHRnIiwiYSI6ImNpaWF6MGdiNDAwanNtemx6MmIyNXoyOWIifQ.ndbNtExCMXZHKyfNtEN0Vg', {
        maxZoom: 19
        , id: 'mapbox.streets'
        , attribution: '&lt;a href=&quot;http://openstreetmap.org&quot;&gt;OpenStreetMap&lt;/a&gt; ' +
          '&lt;a href=&quot;http://creativecommons.org/licenses/by-sa/2.0/&quot;&gt;CC-BY-SA&lt;/a&gt; ' +
          '| &amp;copy; &lt;a href=&quot;http://mapbox.com&quot;&gt;Mapbox&lt;/a&gt;'
      }).addTo(map);
      
      str1 = 'SDS&lt;br&gt;Ångströmlaboratoriet&lt;br&gt;59.839264, 17.647075&lt;br&gt;';
      str2 = 'random_string';
      var popup = str1.concat(str2);
      
      L.marker([59.839264,17.647075]).addTo(map)
          .bindPopup(popup)
          .openPopup();

  &lt;/script&gt;
</code></pre>
</body>  
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-sh">du -sh derby.log
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>4.0K	derby.log
</code></pre>
</div>
</div>
<div class="cell markdown">
<h1 id="exercise"><a class="header" href="#exercise">Exercise</a></h1>
<p>Repeat the same with ingesting data from your own favourite city or a small enough region of earth.</p>
</div>
<div class="cell markdown">
<h3 id="tiny-area-in-the-center-of-stockholm"><a class="header" href="#tiny-area-in-the-center-of-stockholm">Tiny area in the center of Stockholm</a></h3>
<p>l = 17.3227</p>
<p>b = 59.0568</p>
<p>r = 18.8196</p>
<p>t = 59.5928</p>
</div>
<div class="cell code" execution_count="1" scrolled="true">
<pre><code class="language-sh">wget -O StockholmCentrumWgot.osm &quot;https://api.openstreetmap.org/api/0.6/map?bbox=18.0594,59.3213,18.0828,59.3297&quot;
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>--2022-02-02 09:02:35--  https://api.openstreetmap.org/api/0.6/map?bbox=18.0594,59.3213,18.0828,59.3297
Resolving api.openstreetmap.org (api.openstreetmap.org)... 130.117.76.12, 130.117.76.13, 130.117.76.11, ...
Connecting to api.openstreetmap.org (api.openstreetmap.org)|130.117.76.12|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: unspecified [application/xml]
Saving to: ‘StockholmCentrumWgot.osm’

     0K .......... .......... .......... .......... .......... 1.28M
    50K .......... .......... .......... .......... .......... 2.91M
   100K .......... .......... .......... .......... .......... 2.91M
   150K .......... .......... .......... .......... .......... 2.79M
   200K .......... .......... .......... .......... .......... 4.07M
   250K .......... .......... .......... .......... .......... 3.36M
   300K .......... .......... .......... .......... .......... 3.42M
   350K .......... .......... .......... .......... .......... 2.99M
   400K .......... .......... .......... .......... .......... 3.72M
   450K .......... .......... .......... .......... .......... 4.72M
   500K .......... .......... .......... .......... .......... 4.00M
   550K .......... .......... .......... .......... .......... 3.73M
   600K .......... .......... .......... .......... .......... 4.85M
   650K .......... .......... .......... .......... .......... 4.06M
   700K .......... .......... .......... .......... .......... 5.29M
   750K .......... .......... .......... .......... .......... 4.05M
   800K .......... .......... .......... .......... .......... 5.09M
   850K .......... .......... .......... .......... .......... 5.64M
   900K .......... .......... .......... .......... .......... 4.71M
   950K .......... .......... .......... .......... .......... 4.81M
  1000K .......... .......... .......... .......... .......... 5.12M
  1050K .......... .......... .......... .......... .......... 6.06M
  1100K .......... .......... .......... .......... .......... 5.13M
  1150K .......... .......... .......... .......... .......... 6.01M
  1200K .......... .......... .......... .......... .......... 5.11M
  1250K .......... .......... .......... .......... .......... 8.70M
  1300K .......... .......... .......... .......... .......... 6.68M
  1350K .......... .......... .......... .......... .......... 5.20M
  1400K .......... .......... .......... .......... .......... 6.42M
  1450K .......... .......... .......... .......... .......... 6.45M
  1500K .......... .......... .......... .......... .......... 6.48M
  1550K .......... .......... .......... .......... .......... 5.72M
  1600K .......... .......... .......... .......... .......... 8.91M
  1650K .......... .......... .......... .......... .......... 6.67M
  1700K .......... .......... .......... .......... .......... 1.83M
  1750K .......... .......... .......... .......... .......... 8.00M
  1800K .......... .......... .......... .......... .......... 4.91M
  1850K .......... .......... .......... .......... .......... 9.52M
  1900K .......... .......... .......... .......... .......... 9.11M
  1950K .......... .......... .......... .......... .......... 6.09M
  2000K .......... .......... .......... .......... .......... 8.55M
  2050K .......... .......... .......... .......... .......... 9.80M
  2100K .......... .......... .......... .......... .......... 6.38M
  2150K .......... .......... .......... .......... .......... 9.53M
  2200K .......... .......... .......... .......... .......... 9.36M
  2250K .......... .......... .......... .......... .......... 7.45M
  2300K .......... .......... .......... .......... .......... 8.24M
  2350K .......... .......... .......... .......... .......... 9.74M
  2400K .......... .......... .......... .......... ..........  425K
  2450K .......... .......... .......... .......... .......... 11.8M
  2500K .......... .......... .......... .......... .......... 9.60M
  2550K .......... .......... .......... .......... .......... 6.21M
  2600K .......... .......... .......... .......... .......... 13.6M
  2650K .......... .......... .......... .......... .......... 11.4M
  2700K .......... .......... .......... .......... .......... 6.61M
  2750K .......... .......... .......... .......... .......... 11.7M
  2800K .......... .......... .......... .......... .......... 13.1M
  2850K .......... .......... .......... .......... .......... 11.7M
  2900K .......... .......... .......... .......... .......... 7.42M
  2950K .......... .......... .......... .......... .......... 11.9M
  3000K .......... .......... .......... .......... .......... 12.6M
  3050K .......... .......... .......... .......... .......... 12.3M
  3100K .......... .......... .......... .......... .......... 7.43M
  3150K .......... .......... .......... .......... .......... 12.2M
  3200K .......... .......... .......... .......... .......... 13.9M
  3250K .......... .......... .......... .......... .......... 16.7M
  3300K .......... .......... .......... .......... .......... 6.82M
  3350K .......... .......... .......... .......... .......... 14.7M
  3400K .......... .......... .......... .......... .......... 13.8M
  3450K .......... .......... .......... .......... .......... 13.8M
  3500K .......... .......... .......... .......... .......... 7.43M
  3550K .......... .......... .......... .......... .......... 12.7M
  3600K .......... .......... .......... .......... .......... 17.8M
  3650K .......... .......... .......... .......... .......... 14.8M
  3700K .......... .......... .......... .                     20.1M=0.7s

2022-02-02 09:02:37 (5.00 MB/s) - ‘StockholmCentrumWgot.osm’ saved [3820981]
</code></pre>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">dbutils.fs.cp(&quot;file:///databricks/driver/StockholmCentrumWgot.osm&quot;,&quot;dbfs:///datasets/maps/&quot;)
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>res15: Boolean = true
</code></pre>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">display(dbutils.fs.ls(&quot;dbfs:///datasets/maps/&quot;))
</code></pre>
<div class="output execute_result tabular_result" execution_count="1">
<table>
<thead>
<tr class="header">
<th>path</th>
<th>name</th>
<th>size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>dbfs:/datasets/maps/StockholmCentrumWgot.osm</td>
<td>StockholmCentrumWgot.osm</td>
<td>3820981.0</td>
</tr>
<tr class="even">
<td>dbfs:/datasets/maps/TinyUppsalaCentrumWgot.osm</td>
<td>TinyUppsalaCentrumWgot.osm</td>
<td>919096.0</td>
</tr>
<tr class="odd">
<td>dbfs:/datasets/maps/UppsalaCentrumWgot.osm</td>
<td>UppsalaCentrumWgot.osm</td>
<td>8667122.0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">val stockholm_path = &quot;dbfs:/datasets/maps/StockholmCentrumWgot.osm&quot;
val stockholmCentrumOsmDF = spark.read
      .format(&quot;magellan&quot;)
      .option(&quot;type&quot;, &quot;osm&quot;)
      .load(path)
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>stockholm_path: String = dbfs:/datasets/maps/StockholmCentrumWgot.osm
stockholmCentrumOsmDF: org.apache.spark.sql.DataFrame = [point: point, polyline: polyline ... 3 more fields]
</code></pre>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">stockholmCentrumOsmDF.count
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>res18: Long = 1857
</code></pre>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">stockholmCentrumOsmDF.show(10)
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>+-----+--------------------+--------------------+--------------------+-----+
|point|            polyline|             polygon|            metadata|valid|
+-----+--------------------+--------------------+--------------------+-----+
| null|magellan.PolyLine...|                null|[building -&gt; retail]| true|
| null|                null|magellan.Polygon@...|   [building -&gt; yes]| true|
| null|                null|magellan.Polygon@...|[building -&gt; yes,...| true|
| null|                null|magellan.Polygon@...|[building -&gt; yes,...| true|
| null|                null|magellan.Polygon@...|   [building -&gt; yes]| true|
| null|                null|magellan.Polygon@...|   [building -&gt; yes]| true|
| null|magellan.PolyLine...|                null|[name -&gt; Kungsgat...| true|
| null|magellan.PolyLine...|                null|[footway -&gt; sidew...| true|
| null|magellan.PolyLine...|                null|[highway -&gt; platf...| true|
| null|magellan.PolyLine...|                null|[name -&gt; B, sourc...| true|
+-----+--------------------+--------------------+--------------------+-----+
only showing top 10 rows
</code></pre>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">val point = sc.parallelize(Seq((59.3252155, 18.0708309))).toDF(&quot;x&quot;, &quot;y&quot;)
val pointc = point.collect()
val string2 = pointc.mkString(&quot;,&quot;)
val string22 = &quot;'random_string'&quot;
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>point: org.apache.spark.sql.DataFrame = [x: double, y: double]
pointc: Array[org.apache.spark.sql.Row] = Array([59.32503,18.07078])
string2: String = [59.32503,18.07078]
string22: String = 'random_string'
</code></pre>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="auto">
<pre><code class="language-scala">def genLeafletHTML(): String = {
  // you should get your own later!
  val accessToken = &quot;pk.eyJ1IjoidmptMTk5NiIsImEiOiJja3o1Y2RmMXgwbms5MnVrMjdsM3BjNnV2In0.rmgnUxZDekPzmRHyeAIv2Q&quot;

  
  val generatedHTML = f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;  
  &lt;html&gt;
  &lt;head&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css&quot;&gt;
        &lt;style&gt;#map {width: 600px; height:400px;}&lt;/style&gt;
  &lt;/head&gt;
  
  &lt;body&gt;
      &lt;div id=&quot;map&quot; style=&quot;width: 600px; height: 400px&quot;&gt;&lt;/div&gt;
      &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js&quot;&gt;&lt;/script&gt;
      &lt;script type=&quot;text/javascript&quot;&gt;
          var map = L.map('map').setView([59.3252155, 18.0708309], 13);

          L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=$accessToken', {
            maxZoom: 19
            , id: 'mapbox.streets'
            , attribution: '&lt;a href=&quot;http://openstreetmap.org&quot;&gt;OpenStreetMap&lt;/a&gt; ' +
              '&lt;a href=&quot;http://creativecommons.org/licenses/by-sa/2.0/&quot;&gt;CC-BY-SA&lt;/a&gt; ' +
              '| &amp;copy; &lt;a href=&quot;http://mapbox.com&quot;&gt;Mapbox&lt;/a&gt;',
              accessToken: 'your.mapbox.access.token'
          }).addTo(map);
          
          str1 = 'SDS&lt;br&gt;Nobel Museum&lt;br&gt;59.3252155, 18.0708309&lt;br&gt;';
          str2 = ${string22};
          var popup = str1.concat(str2);
          
          L.marker(${string2}).addTo(map)
              .bindPopup(popup)
              .openPopup();

      &lt;/script&gt;
  &lt;/body&gt;  
  &quot;&quot;&quot;
  generatedHTML
}

displayHTML(genLeafletHTML)
</code></pre>
<div class="output execute_result html_result" execution_count="1">
<!DOCTYPE html>  
<html>
  <head>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css">
        <style>#map {width: 600px; height:400px;}</style>
  </head>
<body>
      <div id="map" style="width: 600px; height: 400px"></div>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>
      <script type="text/javascript">
          var map = L.map('map').setView([59.3252155, 18.0708309], 13);
<pre><code>      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoidmptMTk5NiIsImEiOiJja3o1Y2RmMXgwbms5MnVrMjdsM3BjNnV2In0.rmgnUxZDekPzmRHyeAIv2Q', {
        maxZoom: 19
        , id: 'mapbox.streets'
        , attribution: '&lt;a href=&quot;http://openstreetmap.org&quot;&gt;OpenStreetMap&lt;/a&gt; ' +
          '&lt;a href=&quot;http://creativecommons.org/licenses/by-sa/2.0/&quot;&gt;CC-BY-SA&lt;/a&gt; ' +
          '| &amp;copy; &lt;a href=&quot;http://mapbox.com&quot;&gt;Mapbox&lt;/a&gt;',
          accessToken: 'your.mapbox.access.token'
      }).addTo(map);
      
      str1 = 'SDS&lt;br&gt;Nobel Museum&lt;br&gt;59.3252155, 18.0708309&lt;br&gt;';
      str2 = 'random_string';
      var popup = str1.concat(str2);
      
      L.marker([59.32503,18.07078]).addTo(map)
          .bindPopup(popup)
          .openPopup();

  &lt;/script&gt;
</code></pre>
</body>  
</div>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../contents/000_5-sds-2-x-geo/031_GeospatialAnalyticsInMagellan.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../contents/000_5-sds-2-x-geo/032_NYtaxisInMagellan.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../contents/000_5-sds-2-x-geo/031_GeospatialAnalyticsInMagellan.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../contents/000_5-sds-2-x-geo/032_NYtaxisInMagellan.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
