
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prediction with time series model - Gaussian Processes &#8212; Scalable Data Science &amp; Distributed Machine Learning</title>
    
  <link rel="stylesheet" href="../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Genomics Analysis with Glow and Spark" href="../student-project-13_group-Genomics/01_1000genomes.html" />
    <link rel="prev" title="Prediction with Time Series model - ARIMA" href="07_DataPredicton_ARIMA.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Scalable Data Science & Distributed Machine Learning</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/000_ScaDaMaLe.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Introduction to Apache Spark Core
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../000_1-sds-3-x/001_whySpark.html">
   Why Apache Spark?
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html">
     Login to databricks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#import-course-content-now">
     Import Course Content Now!
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#cloud-free-computing-environment">
     Cloud-free Computing Environment
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/002_01_multiLingualNotebooks.html">
     Multi-lingual Notebooks
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html">
   Scala Crash Course
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html">
     Scala Crash Course Continued
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../000_1-sds-3-x/004_RDDsTransformationsActions.html">
   Introduction to Spark
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/005_RDDsTransformationsActionsHOMEWORK.html">
     HOMEWORK on RDD Transformations and Actions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html">
     Piped RDDs and Bayesian AB Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#from-a-local-collection">
     From a Local Collection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#glom">
     glom
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#checkpointing">
     Checkpointing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#pipe-rdds-to-system-commands">
     Pipe RDDs to System Commands
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#mappartitions">
     mapPartitions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#foreachpartition">
     foreachPartition
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#numerically-rigorous-bayesian-ab-testing">
     Numerically Rigorous Bayesian AB Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#usage-instructions-for-isit1or2coins">
     Usage instructions for IsIt1or2Coins
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/006_WordCount.html">
     Word Count on US State of the Union (SoU) Addresses
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Introduction to Apache Spark SQL
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007_SparkSQLIntroBasics.html">
   Introduction to Spark SQL
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../000_1-sds-3-x/007_SparkSQLIntroBasics.html#getting-started-in-spark-2-x">
   Getting Started in Spark 2.x
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007a_SparkSQLProgGuide_HW.html">
     Spark Sql Programming Guide
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007b_SparkSQLProgGuide_HW.html">
     Getting Started
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007b_SparkSQLProgGuide_HW.html#id1">
     Getting Started
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007c_SparkSQLProgGuide_HW.html">
     Getting Started - Exercise
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007d_SparkSQLProgGuide_HW.html">
     Data Sources
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007d_SparkSQLProgGuide_HW.html#id1">
     Data Sources
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007e_SparkSQLProgGuide_HW.html">
     Performance Tuning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007f_SparkSQLProgGuide_HW.html">
     Distributed SQL Engine
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007f_SparkSQLProgGuide_HW.html#id1">
     Distributed SQL Engine
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html">
     ScaDaMaLe, Scalable Data Science and Distributed Machine Learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#sql-pivoting-since-spark-2-4">
     SQL Pivoting since Spark 2.4
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#load-data">
     Load Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#pivoting-in-sql">
     Pivoting in SQL
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#pivoting-with-multiple-aggregate-expressions">
     Pivoting with Multiple Aggregate Expressions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#pivoting-with-multiple-grouping-columns">
     Pivoting with Multiple Grouping Columns
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#pivoting-with-multiple-pivot-columns">
     Pivoting with Multiple Pivot Columns
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Extract Transform and Load
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html">
   Diamonds ML Pipeline Workflow - DataFrame ETL and EDA Part
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#step-1-load-data-as-dataframe">
   Step 1. Load data as DataFrame
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#step-2-understand-the-data">
   Step 2. Understand the data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#let-us-run-through-some-basic-inteactive-sql-queries-next">
   Let us run through some basic inteactive SQL queries next
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#why-do-we-need-to-know-these-interactive-sql-queries">
   Why do we need to know these interactive SQL queries?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#we-will-continue-later-with-ml-pipelines-to-do-prediction-with-a-fitted-model-from-this-dataset">
   We will continue later with ML pipelines to do prediction with a fitted model from this dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html">
   Power Plant ML Pipeline Application - DataFrame Part
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#step-1-business-understanding">
   Step 1: Business Understanding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#step-2-load-your-data">
   Step 2: Load Your Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#use-this-for-other-smallish-datasets-you-want-to-import-to-your-ce">
   USE THIS FOR OTHER SMALLish DataSets you want to import to your CE
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#step-3-explore-your-data">
   Step 3: Explore Your Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#step-4-visualize-your-data">
   Step 4: Visualize Your Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/010_wikipediaClickStream_01ETLEDA.html">
   Wiki Clickstream Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/010_wikipediaClickStream_01ETLEDA.html#wikipedia-logo">
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_LoadExtract.html">
   Old Bailey Online Data Analysis in Apache Spark
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_LoadExtract.html#analysing-the-full-old-bailey-online-sessions-papers-dataset">
   Analysing the Full Old Bailey Online Sessions Papers Dataset
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html">
     Piped RDDs and Bayesian AB Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#from-a-local-collection">
     From a Local Collection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#glom">
     glom
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#checkpointing">
     Checkpointing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#pipe-rdds-to-system-commands">
     Pipe RDDs to System Commands
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#mappartitions">
     mapPartitions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#foreachpartition">
     foreachPartition
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#numerically-rigorous-bayesian-ab-testing">
     Numerically Rigorous Bayesian AB Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#usage-instructions-for-isit1or2coins">
     Usage instructions for IsIt1or2Coins
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#parsing-the-output-from-isit1or2coins">
     Parsing the output from
     <code class="docutils literal notranslate">
      <span class="pre">
       IsIt1or2Coins
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#providing-case-classes-for-input-and-output-for-easy-spark-communication">
     Providing case classes for input and output for easy spark communication
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/035_LDA_CornellMovieDialogs.html">
   Topic Modeling of Movie Dialogs with Latent Dirichlet Allocation
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Trends in Money and News
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../000_9-sds-3-x-trends/000_TrendsInFinancialStocksAndNewsEvents.html">
   Trends in Financial Stocks and News Events
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_9-sds-3-x-trends/00a_FX1M.html">
     Historical FX-1-M Financial Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_9-sds-3-x-trends/00b_yfinance.html">
     yfinance Stock Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_9-sds-3-x-trends/000a_finance_utils.html">
     Utilities Needed for Financial Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_9-sds-3-x-trends/000b_gdelt_utils.html">
     Utilities Needed for Mass Media Data
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../000_9-sds-3-x-trends/01_trend_calculus_showcase.html">
   Finding trends in oil price data.
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_9-sds-3-x-trends/02_streamable_trend_calculus.html">
     Streaming Trend Calculus with Maximum Necessary Reversals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_9-sds-3-x-trends/03_streamable_trend_calculus_estimators.html">
     Markov Model for Trend Calculus
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../000_9-sds-3-x-trends/030_Spark_GDELT_project_001.html">
   Plugging into GDELT Mass Media Streams
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_9-sds-3-x-trends/030a_gdelt_EOI_detection.html">
     Detecting Events of Interest to OIL/GAS Price Trends
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_9-sds-3-x-trends/030b_gdelt_POI_detection.html">
     Detecting Persons of Interest to OIL/GAS Price Trends
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Distributed Deep Learning with Horovod
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../000_7-sds-3-x-ddl/00_DDL_Introduction.html">
   Introduction to Distributed Deep Learning (DDL) with Horovod over Tensorflow/keras and Pytorch
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_7-sds-3-x-ddl/0x_mnist-tensorflow-keras.html">
     Distributed deep learning training using TensorFlow and Keras with HorovodRunner
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_7-sds-3-x-ddl/0y_mnist-pytorch.html">
     Distributed deep learning training using PyTorch with HorovodRunner for MNIST
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  WASP AI-Track Student Projects
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-01_group-TheTwoCultures/00_download_data.html">
   The two cultures
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-01_group-TheTwoCultures/01_load_data.html">
     Preprocessing and loading the relevant data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-01_group-TheTwoCultures/02_logisticregression.html">
     The two cultures - Classifying threads with logistic regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-01_group-TheTwoCultures/03_word2vec.html">
     Classification using Word2Vec
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-01_group-TheTwoCultures/04_LDA.html">
     Topic Modeling with LDA
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-02_group-LiUUmeaSceneGraphMotifs/01_SceneGraphMotifs.html">
   Exploring the GQA Scene Graph Dataset Structure and Properties
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-03_group-GuangyiZhang/01_triads.html">
   Signed Triads in Social Media
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-04_group-DistributedLinearAlgebra/01_DistributedSVD.html">
   Distributed Linear Algebra
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-04_group-DistributedLinearAlgebra/02_CollaborativeFiltering.html">
     Music Recommendation System
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-05_group-LundDirichletAnalysts/01_Wikipedia_LDA_Analysis.html">
   Wikipedia analysis using Latent Dirichlet Allocation (LDA)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-06_group-ParticleClustering/00_Introduction.html">
   Unsupervised clustering of particle physics data with distributed training
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-06_group-ParticleClustering/00_Introduction.html#introduction">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-06_group-ParticleClustering/00_Introduction.html#background">
   Background
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-06_group-ParticleClustering/00_Introduction.html#the-uclusted-algorithm">
   The UClusted algorithm
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-06_group-ParticleClustering/00_Introduction.html#motivation">
   Motivation
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-06_group-ParticleClustering/00_Introduction.html#our-contribution">
   Our contribution
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-06_group-ParticleClustering/01_data_and_preprocessing.html">
     Important!
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-06_group-ParticleClustering/01_data_and_preprocessing.html#important-continued-from-above">
     Important (continued from above)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-06_group-ParticleClustering/04_evaluate.html">
     Evaluation
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-07_group-MathAtKTH/01_Coding_Motifs.html">
   Motif Finding
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-07_group-MathAtKTH/01_Coding_Motifs.html#application">
   Application
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-07_group-MathAtKTH/02_Data_Processing.html">
     Data Processing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-07_group-MathAtKTH/03_graph_string_converter.html">
     Intro
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-07_group-MathAtKTH/03_graph_string_converter.html#examples">
     Examples
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-08_group-DistributedEnsemble/00_project.html">
   Distributed ensembles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-08_group-DistributedEnsemble/00_project.html#distributed-ensembles-prediction-api">
   Distributed ensembles prediction API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-08_group-DistributedEnsemble/00_project.html#application-example-distributed-predictions">
   Application example: Distributed predictions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-08_group-DistributedEnsemble/00_project.html#application-example-out-of-distribution-detection">
   Application example: Out of distribution detection
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-09_group-TopicModeling/01_Introduction.html">
   Topic Modeling with SARS-Cov-2 Genome ðŸ§¬
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/02_Data_Processing.html">
     Extract (overlapping [since yet do not know which parts corresponds to coding regions]) 3-mers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/03_LDA.html">
     Load processed data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/03_LDA.html#format-data-for-apache-spark-mllib-clustering-lda-adapted-from-the-lda-course-tutorial-034lda20newsgroupssmall">
     Format data for apache.spark.mllib.clustering.LDA (adapted from the LDA course tutorial â€˜034
     <em>
      LDA
     </em>
     20NewsGroupsSmallâ€™)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/03_LDA.html#visualise-results">
     Visualise Results
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/04_Classification_CountVector.html">
     Load processed data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/04_Classification_CountVector.html#format-data">
     Format data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/04_Classification_CountVector.html#classification">
     Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/04_Classification_CountVector.html#evaluation">
     Evaluation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/05_Classification.html">
     Load processed data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/05_Classification.html#explore-data">
     Explore data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/05_Classification.html#classification">
     Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/05_Classification.html#evaluation">
     Evaluation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/06_Results.html">
     Results and Conclusion
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-10_group-Geosmus/01_Introduction.html">
   Twitter Streaming Using Geolocation and Emoji Based Sentiment Analysis
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-10_group-Geosmus/02_ClusteringEmoticonsBasedOnTweets.html">
     Clustering emoticons based on tweets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-10_group-Geosmus/03_Dynamic_Tweet_Maps.html">
     Dynamic Tweet Maps
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-10_group-Geosmus/04_conclusion.html">
     Conclusion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-10_group-Geosmus/05_appendix_get-cc-data.html">
     Notebook for collecting tweets with country codes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-10_group-Geosmus/07_a_appendix_extendedTwitterUtils2run.html">
     ScaDaMaLe, Scalable Data Science and Distributed Machine Learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-10_group-Geosmus/07_a_appendix_extendedTwitterUtils2run.html#extended-spark-streaming-twitter-twitterutils">
     Extended spark.streaming.twitter.TwitterUtils
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-10_group-Geosmus/07_b_appendix_TTTDFfunctions.html">
     ScaDaMaLe, Scalable Data Science and Distributed Machine Learning
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-11_group-Sketchings/00_QuantileEstimation.html">
   Anomaly Detection with Iterative Quantile Estimation and T-digest
  </a>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="00_ProjectDescriptionAndPlanning.html">
   Project Description and Introduction
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="01_DownloadFilesPeriodicallyScript.html">
     Download Files Periodically
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01_StreamToFile.html">
     Stream to parquet file
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="021_DataPreprocess_Explain.html">
     Loading data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="021_DataPreprocess_Explain.html#preprocessing">
     Preprocessing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02_DataPreprocess.html">
     Loading data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02_DataPreprocess.html#preprocessing">
     Preprocessing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_ExplosiveAnalysis.html">
     This notebook is for explosive analysis of features in data.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_ExplosiveAnalysis.html#statistics-of-invariant-features">
     Statistics of invariant features
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_ExplosiveAnalysis.html#correlation-between-invariant-features">
     Correlation between invariant features
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_ExplosiveAnalysis.html#correlation-between-new-case-per-million-total-case-new-death-per-million-total-death-per-million-reproduction-rate-and-stringency-index">
     Correlation between new case per million, total case, new death per million, total death per million, reproduction rate and stringency index.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04_DataVisualize.html">
     Show reproduction rate of selected countries i.e. Sweden, Germany, Danmark, Finland, Norway
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04_DataVisualize.html#visualize-total-cases-total-deaths-new-cases-and-new-deaths-during-pandemic">
     Visualize total cases, total deaths, new cases and new deaths during pandemic
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04_DataVisualize.html#total-deaths">
     Total Deaths
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04_DataVisualize.html#new-cases">
     New Cases
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04_DataVisualize.html#new-deaths">
     New Deaths
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05_Clustering.html">
     Clustering of country features in the Covid 19 dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06_DataPredicton_LR.html">
     Prediction with Linear Regression (LR) Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07_DataPredicton_ARIMA.html">
     Prediction with Time Series model - ARIMA
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Prediction with time series model - Gaussian Processes
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-13_group-Genomics/01_1000genomes.html">
   Genomics Analysis with Glow and Spark
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-13_group-Genomics/01_1000genomes.html#load-libs-and-define-helper-functions">
   Load libs and define helper functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-13_group-Genomics/01_1000genomes.html#read-data">
   Read data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-13_group-Genomics/01_1000genomes.html#pca">
   PCA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-13_group-Genomics/01_1000genomes.html#predicting-ethinicity">
   Predicting Ethinicity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-13_group-Genomics/01_1000genomes.html#filtering-of-snps-based-on-chi-squared-test">
   Filtering of SNPs based on chi-squared test
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-14_group-NullHypothesisEvaluationCriteria/00_distributed_combinatorial_bandit.html">
   Distributional combinatorial bandits
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-15_group-FinancialDataStreams/00_video.html">
   Reinforcement Learning for Intraday Trading
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-15_group-FinancialDataStreams/01_rl_intraday_trading.html">
     Reinforcement Learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-15_group-FinancialDataStreams/01_rl_intraday_trading.html#summary-and-outlook">
     Summary and Outlook
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-15_group-FinancialDataStreams/02_rl_intraday_trading_elephas.html">
     Reinforcement Learning - Distributed model tuning with Elephas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-15_group-FinancialDataStreams/02_rl_intraday_trading_elephas.html#elephas">
     Elephas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-15_group-FinancialDataStreams/02_rl_intraday_trading_elephas.html#notes-to-the-elephas-training">
     Notes to the elephas training
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-15_group-FinancialDataStreams/03_resources.html">
     Resources
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-16_group-IntrusionDetection/00_Introduction.html">
   Intrusion Detection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-16_group-IntrusionDetection/00_Introduction.html#preparing-the-dataframe-for-training-classifers">
   Preparing the DataFrame for training classifers
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-17_group-TowardsScalableTDA/00_introduction.html">
   Density Estimation via Voronoi Diagrams in High Dimensions
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-17_group-TowardsScalableTDA/03_robotics_dataset.html">
     Robotics Dataset
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-18_group-ProjectRL/00_Problem_Description.html">
   Recommender System
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-18_group-ProjectRL/01_The_ALS_method.html">
     <span class="xref myst">
      The Alternating Least Squares method (ALS)
     </span>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-18_group-ProjectRL/01_The_ALS_method.html#on-a-small-dataset">
     <span class="xref myst">
      On a small dataset
     </span>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-18_group-ProjectRL/01_The_ALS_method.html#on-a-large-dataset-netflix-dataset">
     <span class="xref myst">
      On a large dataset - Netflix dataset
     </span>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-18_group-ProjectRL/02_Extensions.html">
     Extensions
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-19_group-Featuring/01_FundamentalMatrix.html">
   Fundamental Matrix
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-20_group-Generalization/01_Background.html">
   MixUp and Generalization
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-20_group-Generalization/02_Random_Forest.html">
     Random Forests and MixUp
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-20_group-Generalization/03_CNN_MNIST.html">
     CNN for MNIST
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-20_group-Generalization/04_CNN_Intel_Image.html">
     CNN for Intel Image Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-20_group-Generalization/05_Horovod_test.html">
     CNNs and MixUp with Horovod
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-21_group-GraphSpectralAnalysis/00_introduction.html">
   Graph Spectral Analysis
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-21_group-GraphSpectralAnalysis/01_preprocess_data.html">
     Preprocess the data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-21_group-GraphSpectralAnalysis/02_generate_graphs.html">
     Generate random graphs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-21_group-GraphSpectralAnalysis/03_compute_rsvd.html">
     Compute RSVD
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-21_group-GraphSpectralAnalysis/04_analyse_eigenvalues.html">
     Analyse the eigenvalue spectrum
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-22_group-SwapWithDDP/00_Introduction.html">
   SWAP
   <em>
    With
   </em>
   DDP
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-22_group-SwapWithDDP/01_SWAP_with_DDP.html">
     SWAP
     <em>
      With
     </em>
     DDP
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/000_0-sds-3-x-projects/student-project-12_group-CovidPandemic/08_DataPrediction_GP.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://lamastex.github.io/ScaDaMaLe/index.html"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://lamastex.github.io/ScaDaMaLe/index.html/issues/new?title=Issue%20on%20page%20%2F000_0-sds-3-x-projects/student-project-12_group-CovidPandemic/08_DataPrediction_GP.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#world-data-preprocessing">
   2.1 World data preprocessing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sweden-preprocessing">
   2.2 Sweden preprocessing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#world-multistep-prediction">
   3.1 World multistep prediction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#world-onestep-prediction">
   3.2 World onestep prediction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sweden-multistep-prediction">
   3.3 Sweden multistep prediction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sweden-onestep-prediction">
   3.4 Sweden onestep prediction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sweden-multistep-prediction-with-additional-data-input-from-neighbouring-country">
   3.5 Sweden multistep prediction with additional data input from neighbouring country
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#world-multistep">
   4.1 World multistep
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#world-onestep">
   4.2 World onestep
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sweden-multistep">
   4.2 Sweden multistep
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sweden-onestep">
   4.4 Sweden onestep
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sweden-multistep-with-additional-information">
   4.4 Sweden multistep with additional information
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="prediction-with-time-series-model-gaussian-processes">
<h1>Prediction with time series model - Gaussian Processes<a class="headerlink" href="#prediction-with-time-series-model-gaussian-processes" title="Permalink to this headline">Â¶</a></h1>
<p>This notebook contains time series prediction with gaussian processes.
The data used for prediction is new cases (smoothed) and new deaths
(smoothed) for both an aggregated number of countries in the world and
for Sweden. To implement the gaussian process model, the python package
Gpytorch is used.</p>
<ol class="simple">
<li><p>Install, import, load and preprocess data</p></li>
</ol>
<hr class="docutils" />
<p>Install, import and execute the other relevant notebooks here to load
and preprocess dataâ€¦</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">gpytorch</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Python interpreter will be restarted.
Collecting gpytorch
  Downloading gpytorch-1.3.0.tar.gz (283 kB)
Building wheels for collected packages: gpytorch
  Building wheel for gpytorch (setup.py): started
  Building wheel for gpytorch (setup.py): finished with status &#39;done&#39;
  Created wheel for gpytorch: filename=gpytorch-1.3.0-py2.py3-none-any.whl size=473796 sha256=5882e250a68a9042a1e51e11617837c2e922878bd22e515cf9459b217c96ba2b
  Stored in directory: /root/.cache/pip/wheels/1d/f0/2c/2146864c1f7bd8a844c4143115c05c392da763fd8b249adb9d
Successfully built gpytorch
Installing collected packages: gpytorch
Successfully installed gpytorch-1.3.0
Python interpreter will be restarted.
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># python imports</span>
<span class="kn">import</span> <span class="nn">gpytorch</span> <span class="k">as</span> <span class="nn">gpth</span>
<span class="kn">import</span> <span class="nn">torch</span> <span class="k">as</span> <span class="nn">th</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;./02_DataPreprocess&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>[TABLE]</p>
<p>[TABLE]</p>
<p>Truncated to 30 rows</p>
<p>Truncated to 12 cols</p>
<ol class="simple">
<li><p>Additional data preprocessing in Scala</p></li>
</ol>
<hr class="docutils" />
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import org.apache.spark.sql.functions._
import org.apache.spark.sql.expressions.Window
</pre></div>
</div>
</div></blockquote>
<div class="section" id="world-data-preprocessing">
<h2>2.1 World data preprocessing<a class="headerlink" href="#world-data-preprocessing" title="Permalink to this headline">Â¶</a></h2>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>df_filteredLocation: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [iso_code: string, continent: string ... 48 more fields]
df_fillContinentNull: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [iso_code: string, continent: string ... 48 more fields]
res3: df_filteredLocation.type = [iso_code: string, continent: string ... 48 more fields]
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">define</span> <span class="n">dataframe</span> <span class="n">summing</span> <span class="n">up</span> <span class="n">the</span> <span class="n">new</span> <span class="n">cases</span> <span class="n">smoothed</span> <span class="k">for</span> <span class="n">each</span> <span class="n">date</span>
<span class="n">val</span> <span class="n">df_ncworld</span> <span class="o">=</span> <span class="n">df_cleaned_time_series</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;new_cases_smoothed&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(new_cases_smoothed)&quot;</span><span class="p">,</span><span class="s2">&quot;new_cases_smoothed&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_ncworld</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>[TABLE]</p>
<p>Truncated to 30 rows</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>df_filtered_date: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [iso_code: string, continent: string ... 48 more fields]
res5: df_fillContinentNull.type = [iso_code: string, continent: string ... 48 more fields]
</pre></div>
</div>
</div></blockquote>
<p>[TABLE]</p>
<p>Truncated to 30 rows</p>
<p>Truncated to 12 cols</p>
<p>[TABLE]</p>
<p>Truncated to 30 rows</p>
<p>Truncated to 12 cols</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>df_cleaned_feature_permillion: org.apache.spark.sql.DataFrame = [iso_code: string, continent: string ... 48 more fields]
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">define</span> <span class="n">dataframe</span> <span class="n">summing</span> <span class="n">up</span> <span class="n">the</span> <span class="n">new</span> <span class="n">deaths</span> <span class="n">smoothed</span> <span class="k">for</span> <span class="n">each</span> <span class="n">date</span>
<span class="n">val</span> <span class="n">df_ndworld</span> <span class="o">=</span> <span class="n">df_cleaned_time_series</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;new_deaths_smoothed&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(new_deaths_smoothed)&quot;</span><span class="p">,</span><span class="s2">&quot;new_deaths_smoothed&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_ndworld</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>[TABLE]</p>
<p>Truncated to 30 rows</p>
<p>[TABLE]</p>
<p>Truncated to 30 rows</p>
<p>Truncated to 12 cols</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// Add a time index for the date
import org.apache.spark.sql.expressions.Window
val window_spec  = Window.orderBy($&quot;date&quot;)

val df_ncworld_indexed = df_ncworld.withColumn(&quot;time_idx&quot;,row_number.over(window_spec))
val df_ndworld_indexed = df_ndworld.withColumn(&quot;time_idx&quot;,row_number.over(window_spec))
display(df_ncworld_indexed)
</pre></div>
</div>
</div>
</div>
<p>[TABLE]</p>
<p>Truncated to 30 rows</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Get</span> <span class="nb">max</span> <span class="ow">and</span> <span class="nb">min</span> <span class="n">of</span> <span class="n">time</span> <span class="n">index</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.functions.</span><span class="p">{</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">}</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span>

<span class="n">val</span> <span class="n">id_maxmin</span> <span class="o">=</span> <span class="n">df_ncworld_indexed</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="s2">&quot;time_idx&quot;</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="s2">&quot;time_idx&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">val</span> <span class="n">id_max</span><span class="p">:</span> <span class="n">Int</span> <span class="o">=</span> <span class="n">id_maxmin</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">val</span> <span class="n">id_min</span><span class="p">:</span> <span class="n">Int</span> <span class="o">=</span> <span class="n">id_maxmin</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import org.apache.spark.sql.functions.{min, max}
import org.apache.spark.sql.Row
id_maxmin: org.apache.spark.sql.Row = [316,1]
id_max: Int = 316
id_min: Int = 1
</pre></div>
</div>
</div></blockquote>
<p>Extract a window for prediction</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// define training and test data intervalls. test data is set to 10% of the total dataset time length.
val test_wnd: Int = (0.1*id_max).toInt
val train_wnd: Int = (0.9*id_max).toInt

val df_ncworld_train = df_ncworld_indexed.where($&quot;time_idx&quot; &gt; id_max-train_wnd-test_wnd &amp;&amp; $&quot;time_idx&quot; &lt;= id_max-test_wnd)
val df_ncworld_test = df_ncworld_indexed.where($&quot;time_idx&quot; &gt; id_max-test_wnd &amp;&amp; $&quot;time_idx&quot; &lt;= id_max)
val df_ndworld_train = df_ndworld_indexed.where($&quot;time_idx&quot; &gt; id_max-train_wnd-test_wnd &amp;&amp; $&quot;time_idx&quot; &lt;= id_max-test_wnd)
val df_ndworld_test = df_ndworld_indexed.where($&quot;time_idx&quot; &gt; id_max-test_wnd &amp;&amp; $&quot;time_idx&quot; &lt;= id_max)
display(df_ncworld_test)
</pre></div>
</div>
</div>
</div>
<p>[TABLE]</p>
<p>Truncated to 30 rows</p>
<p>Convert to python for further processing</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_ncworld_train</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;df_ncworld_train&quot;</span><span class="p">)</span>
<span class="n">df_ncworld_test</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;df_ncworld_test&quot;</span><span class="p">)</span>
<span class="n">df_ndworld_train</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;df_ndworld_train&quot;</span><span class="p">)</span>
<span class="n">df_ndworld_test</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;df_ndworld_test&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_ncworld_train</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">&quot;df_ncworld_train&quot;</span><span class="p">)</span>
<span class="n">df_ncworld_test</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">&quot;df_ncworld_test&quot;</span><span class="p">)</span>
<span class="n">df_ndworld_train</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">&quot;df_ndworld_train&quot;</span><span class="p">)</span>
<span class="n">df_ndworld_test</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">&quot;df_ndworld_test&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="sweden-preprocessing">
<h2>2.2 Sweden preprocessing<a class="headerlink" href="#sweden-preprocessing" title="Permalink to this headline">Â¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>val df_ncdenswe = df_cleaned_time_series.select($&quot;location&quot;, $&quot;date&quot;, $&quot;new_cases_smoothed&quot;).where(expr(&quot;location = &#39;Sweden&#39; or location = &#39;Denmark&#39;&quot;))
val df_nddenswe = df_cleaned_time_series.select($&quot;location&quot;, $&quot;date&quot;, $&quot;new_deaths_smoothed&quot;).where(expr(&quot;location = &#39;Sweden&#39; or location = &#39;Denmark&#39;&quot;))
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>df_ncdenswe: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [location: string, date: string ... 1 more field]
df_nddenswe: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [location: string, date: string ... 1 more field]
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// Add a time index for the date
import org.apache.spark.sql.expressions.Window
val window_spec  = Window.partitionBy(&quot;location&quot;).orderBy($&quot;date&quot;)

val df_ncdenswe_indexed = df_ncdenswe.withColumn(&quot;time_idx&quot;,row_number.over(window_spec))
display(df_ncdenswe_indexed)

val df_nddenswe_indexed = df_nddenswe.withColumn(&quot;time_idx&quot;,row_number.over(window_spec))
display(df_nddenswe_indexed)
</pre></div>
</div>
</div>
</div>
<p>[TABLE]</p>
<p>Truncated to 30 rows</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>val test_wnd: Int = (0.1*id_max).toInt
val train_wnd: Int = (0.9*id_max).toInt
val df_ncdenswe_train = df_ncdenswe_indexed.where($&quot;time_idx&quot; &gt; id_max-train_wnd-test_wnd &amp;&amp; $&quot;time_idx&quot; &lt;= id_max-test_wnd)
val df_ncdenswe_test = df_ncdenswe_indexed.where($&quot;time_idx&quot; &gt; id_max-test_wnd &amp;&amp; $&quot;time_idx&quot; &lt;= id_max)
val df_nddenswe_train = df_nddenswe_indexed.where($&quot;time_idx&quot; &gt; id_max-train_wnd-test_wnd &amp;&amp; $&quot;time_idx&quot; &lt;= id_max-test_wnd)
val df_nddenswe_test = df_nddenswe_indexed.where($&quot;time_idx&quot; &gt; id_max-test_wnd &amp;&amp; $&quot;time_idx&quot; &lt;= id_max)
display(df_ncdenswe_test)
</pre></div>
</div>
</div>
</div>
<p>[TABLE]</p>
<p>Truncated to 30 rows</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_ncdenswe_train</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;df_ncdenswe_train&quot;</span><span class="p">)</span>
<span class="n">df_ncdenswe_test</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;df_ncdenswe_test&quot;</span><span class="p">)</span>
<span class="n">df_nddenswe_train</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;df_nddenswe_train&quot;</span><span class="p">)</span>
<span class="n">df_nddenswe_test</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;df_nddenswe_test&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_ncdenswe_train</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">&quot;df_ncdenswe_train&quot;</span><span class="p">)</span>
<span class="n">df_ncdenswe_test</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">&quot;df_ncdenswe_test&quot;</span><span class="p">)</span>
<span class="n">df_nddenswe_train</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">&quot;df_nddenswe_train&quot;</span><span class="p">)</span>
<span class="n">df_nddenswe_test</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">&quot;df_nddenswe_test&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ol class="simple">
<li><p>Time series prediction with Gaussian Processes</p></li>
</ol>
<hr class="docutils" />
<p>In this section we perform predictions based on the input data. Some
additional preprocessing in Python is done as well. The transition from
Scala to Python is motivated by the use of the python package Gpytorch
for implementing the gaussian process model.</p>
</div>
<div class="section" id="world-multistep-prediction">
<h2>3.1 World multistep prediction<a class="headerlink" href="#world-multistep-prediction" title="Permalink to this headline">Â¶</a></h2>
<p>As similar operations are performed for processing data, a class is
first defined to enable code reuse</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">class</span> <span class="nc">GPDataSet</span><span class="p">():</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_train</span><span class="p">,</span> <span class="n">df_test</span><span class="p">,</span> <span class="n">datacol</span><span class="p">,</span> <span class="n">filterloc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">add_input</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      class for processing input data to GP. As similar code is reused, this class enables some code reuse.</span>
<span class="sd">      </span>
<span class="sd">      param: &#39;df_train&#39;, training data dataframe</span>
<span class="sd">      param: &#39;df_test&#39;, test data dataframe</span>
<span class="sd">      param: &#39;datacol&#39;, data column in dataframe to perform predictions on, e.g. &#39;new_cases_smoothed&#39;</span>
<span class="sd">      param: &#39;filterloc&#39;, location column in dataframe to perform predictions on, e.g. &#39;Sweden&#39;</span>
<span class="sd">      param: &#39;add_input&#39;, additional location column in dataframe to use as input for predictions, e.g. &#39;Denmark&#39;  </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">df_train</span> <span class="o">=</span> <span class="n">df_train</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">df_test</span> <span class="o">=</span> <span class="n">df_test</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">datacol</span> <span class="o">=</span> <span class="n">datacol</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">filterloc</span> <span class="o">=</span> <span class="n">filterloc</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span> <span class="o">=</span> <span class="n">add_input</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num_xdim</span> <span class="o">=</span> <span class="kc">None</span>    

        
  <span class="k">def</span> <span class="nf">convert_to_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      convert dataframe to numpy arrays. This process may takes a while.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># if no filter for location is specified</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterloc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">x_train_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_train</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;time_idx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;time_idx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">collect</span><span class="p">())</span>
      <span class="n">x_test_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_test</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;time_idx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;time_idx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">collect</span><span class="p">())</span>
      <span class="n">y_train_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_train</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;time_idx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datacol</span><span class="p">)</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">collect</span><span class="p">())</span>    
      <span class="n">y_test_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_test</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;time_idx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datacol</span><span class="p">)</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">collect</span><span class="p">())</span>    
      <span class="n">num_xdim</span> <span class="o">=</span> <span class="mi">1</span>      
      
    <span class="c1"># if a filter for location is specified</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_train_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_train</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterloc</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;time_idx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;time_idx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">collect</span><span class="p">())</span>
        <span class="n">x_test_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_test</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterloc</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;time_idx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;time_idx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">collect</span><span class="p">())</span>
        <span class="n">num_xdim</span> <span class="o">=</span> <span class="mi">1</span>        
     
      <span class="c1"># if prediction should add additional input from e.g. a neighbouring country</span>
      <span class="k">else</span><span class="p">:</span> 
        <span class="n">x_train_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_train</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterloc</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;time_idx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;time_idx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">collect</span><span class="p">())</span>
        <span class="n">x_test_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_test</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterloc</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;time_idx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;time_idx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">collect</span><span class="p">())</span>       
        <span class="n">x_train_add</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_train</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;time_idx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datacol</span><span class="p">)</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">collect</span><span class="p">())</span>
        <span class="n">x_test_add</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_test</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;time_idx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datacol</span><span class="p">)</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">collect</span><span class="p">())</span>    
        <span class="n">x_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x_train_time</span><span class="p">,</span> <span class="n">x_train_add</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">x_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x_test_time</span><span class="p">,</span> <span class="n">x_test_add</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">x_train_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">x_test_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">num_xdim</span> <span class="o">=</span> <span class="mi">2</span>
                 
      <span class="c1"># output data </span>
      <span class="n">y_train_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_train</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterloc</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;time_idx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datacol</span><span class="p">)</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">collect</span><span class="p">())</span>
      <span class="n">y_test_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_test</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterloc</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;time_idx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datacol</span><span class="p">)</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">collect</span><span class="p">())</span>
      
    <span class="bp">self</span><span class="o">.</span><span class="n">x_train_np</span> <span class="o">=</span> <span class="n">x_train_np</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_test_np</span> <span class="o">=</span> <span class="n">x_test_np</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_train_np</span> <span class="o">=</span> <span class="n">y_train_np</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_test_np</span> <span class="o">=</span> <span class="n">y_test_np</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num_xdim</span> <span class="o">=</span> <span class="n">num_xdim</span>
      
  <span class="k">def</span> <span class="nf">plot_numpy_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">      plot numpy arrays </span>
<span class="sd">    &quot;&quot;&quot;</span>   
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_xdim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
      <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train_np</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train_np</span><span class="p">,</span> <span class="s1">&#39;k*&#39;</span><span class="p">)</span>
      <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;train data&#39;</span><span class="p">])</span>
      <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time [days]&#39;</span><span class="p">)</span>
      <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">)</span>
      <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;training data&#39;</span><span class="p">)</span>
      <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>   
      <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train_np</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train_np</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k*&#39;</span><span class="p">)</span>
      <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;train data&#39;</span><span class="p">])</span>
      <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time [days]&#39;</span><span class="p">)</span>
      <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;additional input&#39;</span><span class="p">)</span>
      <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;training data&#39;</span><span class="p">)</span>
      <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>         
    <span class="k">else</span><span class="p">:</span>
      <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
      <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train_np</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train_np</span><span class="p">,</span> <span class="s1">&#39;k*&#39;</span><span class="p">)</span>
      <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;train data&#39;</span><span class="p">])</span>
      <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time [days]&#39;</span><span class="p">)</span>
      <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">)</span>
      <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;training data&#39;</span><span class="p">)</span>
      <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>      
        
  <span class="k">def</span> <span class="nf">get_train_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_xdim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train_np</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train_np</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">process_numpy_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nth_subsample</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">window_red</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      reduction of data by subsampling data and reducing length of data window. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">window_red</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">window_red</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;please adjust &#39;window_red&#39; parameter to be between 0 and 1&quot;</span>
    <span class="n">start_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">get_train_length</span><span class="p">())</span><span class="o">*</span><span class="n">window_red</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span> <span class="o">=</span> <span class="n">th</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train_np</span><span class="p">[</span><span class="n">start_idx</span><span class="p">::</span><span class="n">nth_subsample</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">th</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_test</span> <span class="o">=</span> <span class="n">th</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_test_np</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">th</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">th</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_train_np</span><span class="p">[</span><span class="n">start_idx</span><span class="p">::</span><span class="n">nth_subsample</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">th</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">th</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_test_np</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">th</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>    
    <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
    
  <span class="k">def</span> <span class="nf">set_time_to_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      sets the time vector to start at time zero</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_xdim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">x_train_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train_min</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">x_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train_min</span>      
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">x_train_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train_min</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">x_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_test</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train_min</span>
      
  <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      normalize the data to improve predictions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_time_to_zero</span><span class="p">()</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">x_train_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_train_std</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train_mean</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train_std</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_test</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_test</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train_mean</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train_std</span>     

    <span class="bp">self</span><span class="o">.</span><span class="n">y_train_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_train_std</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train_mean</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train_std</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train_mean</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train_std</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">data_normalized</span> <span class="o">=</span> <span class="kc">True</span>

      
  <span class="k">def</span> <span class="nf">plot_reduced_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      plots the reduced training data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">th</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>      
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_xdim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="s1">&#39;k*&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;train data&#39;</span><span class="p">])</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time [days]&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;training data&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>   
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k*&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;train data&#39;</span><span class="p">])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time [days]&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;additional input&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;training data&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>         
      <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="s1">&#39;k*&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;train data&#39;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time [days]&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;training data&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>     
        
</pre></div>
</div>
</div>
</div>
<p>Use class to convert dataframes to numpy arrays for further processing.
Note, the conversion may take a while.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ncworld</span> <span class="o">=</span> <span class="n">GPDataSet</span><span class="p">(</span><span class="n">df_ncworld_train</span><span class="p">,</span> <span class="n">df_ncworld_test</span><span class="p">,</span> <span class="n">datacol</span> <span class="o">=</span> <span class="s1">&#39;new_cases_smoothed&#39;</span><span class="p">,</span> <span class="n">filterloc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">add_input</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">ds_ndworld</span> <span class="o">=</span> <span class="n">GPDataSet</span><span class="p">(</span><span class="n">df_ndworld_train</span><span class="p">,</span> <span class="n">df_ndworld_test</span><span class="p">,</span> <span class="n">datacol</span> <span class="o">=</span> <span class="s1">&#39;new_deaths_smoothed&#39;</span><span class="p">,</span> <span class="n">filterloc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">add_input</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">ds_ncworld</span><span class="o">.</span><span class="n">convert_to_numpy</span><span class="p">()</span>
<span class="n">ds_ndworld</span><span class="o">.</span><span class="n">convert_to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Plot</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ncworld</span><span class="o">.</span><span class="n">plot_numpy_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ndworld</span><span class="o">.</span><span class="n">plot_numpy_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Process data by subsampling, reducing data window and normalize data.
The gaussian process model is a so called non parametric model and will
be mainly based on the data points. As such, to reduce the computation
and the complexity of the model, we subsample and reduce the number of
datapoints.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ncworld</span><span class="o">.</span><span class="n">process_numpy_data</span><span class="p">(</span><span class="n">nth_subsample</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">window_red</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">)</span>
<span class="n">ds_ndworld</span><span class="o">.</span><span class="n">process_numpy_data</span><span class="p">(</span><span class="n">nth_subsample</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">window_red</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Plot processed data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ncworld</span><span class="o">.</span><span class="n">plot_reduced_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ndworld</span><span class="o">.</span><span class="n">plot_reduced_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Define gaussian process classes using Gpytorch and different kernels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gpytorch</span> <span class="k">as</span> <span class="nn">gpth</span>
<span class="k">class</span> <span class="nc">GPLinearRBF</span><span class="p">(</span><span class="n">gpth</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ExactGP</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">GPLinearRBF</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mean_module</span> <span class="o">=</span> <span class="n">gpth</span><span class="o">.</span><span class="n">means</span><span class="o">.</span><span class="n">ConstantMean</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">covar_module</span> <span class="o">=</span> <span class="n">gpth</span><span class="o">.</span><span class="n">kernels</span><span class="o">.</span><span class="n">ScaleKernel</span><span class="p">(</span><span class="n">gpth</span><span class="o">.</span><span class="n">kernels</span><span class="o">.</span><span class="n">LinearKernel</span><span class="p">()</span> <span class="o">+</span> <span class="n">gpth</span><span class="o">.</span><span class="n">kernels</span><span class="o">.</span><span class="n">RBFKernel</span><span class="p">())</span>
    
  <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">x_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_module</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x_covar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covar_module</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gpth</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">MultivariateNormal</span><span class="p">(</span><span class="n">x_mean</span><span class="p">,</span> <span class="n">x_covar</span><span class="p">)</span>    
  
<span class="k">class</span> <span class="nc">GPLinearMatern</span><span class="p">(</span><span class="n">gpth</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ExactGP</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">GPLinearMatern</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mean_module</span> <span class="o">=</span> <span class="n">gpth</span><span class="o">.</span><span class="n">means</span><span class="o">.</span><span class="n">ConstantMean</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">covar_module</span> <span class="o">=</span> <span class="n">gpth</span><span class="o">.</span><span class="n">kernels</span><span class="o">.</span><span class="n">ScaleKernel</span><span class="p">(</span><span class="n">gpth</span><span class="o">.</span><span class="n">kernels</span><span class="o">.</span><span class="n">LinearKernel</span><span class="p">()</span> <span class="o">+</span> <span class="n">gpth</span><span class="o">.</span><span class="n">kernels</span><span class="o">.</span><span class="n">MaternKernel</span><span class="p">())</span>
    
  <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">x_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_module</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x_covar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covar_module</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gpth</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">MultivariateNormal</span><span class="p">(</span><span class="n">x_mean</span><span class="p">,</span> <span class="n">x_covar</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<p>Define a training class for the Gaussian Process models</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>

<span class="k">class</span> <span class="nc">GPTrainer</span><span class="p">():</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gp_model</span><span class="p">,</span> <span class="n">x_train</span><span class="p">,</span> <span class="n">x_train_min</span><span class="p">,</span> <span class="n">x_train_mean</span><span class="p">,</span> <span class="n">x_train_std</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">y_train_mean</span><span class="p">,</span> <span class="n">y_train_std</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="n">train_iter</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">      class to manage training and prediction of data</span>
<span class="sd">     </span>
<span class="sd">      param: &#39;gp_model&#39;, name of gaussian process model including kernel to use</span>
<span class="sd">      param: &#39;x_train&#39;, pytorch tensor (sequence, dim), normalized input training data, starting at time zero</span>
<span class="sd">      param: &#39;x_train_min&#39;, pytorch tensor, start time of input training data</span>
<span class="sd">      param: &#39;x_train_mean&#39;, pytorch tensor, mean used when normalizing input training data</span>
<span class="sd">      param: &#39;x_train_std&#39;, pytorch tensor, std deviation used when normalizing input training data</span>
<span class="sd">      param: &#39;x_test&#39;, pytorch tensor, normalized input test data, starting at time zero</span>
<span class="sd">      param: &#39;y_train&#39;, pytorch tensor, normalized output training data      </span>
<span class="sd">      param: &#39;y_train_mean&#39;, pytorch tensor, mean used when normalizing output training data</span>
<span class="sd">      param: &#39;y_train_std&#39;, pytorch tensor, std deviation used when normalizing output training data </span>
<span class="sd">      param: &#39;y_test&#39;, pytorch tensor, normalized output test data     </span>
<span class="sd">      param: &#39;device&#39;, cpu or cuda. currently only tested for cpu.</span>
<span class="sd">      param: &#39;train_iter&#39;, number of training iterations to fit kernel parameters to data</span>
<span class="sd">      param: &#39;lr&#39;, learning rate</span>
<span class="sd">      param: &#39;verbose&#39;, print information such as loss during training</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span> <span class="o">=</span> <span class="n">x_train</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_train_min</span> <span class="o">=</span> <span class="n">x_train_min</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_train_mean</span> <span class="o">=</span> <span class="n">x_train_mean</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_train_std</span> <span class="o">=</span> <span class="n">x_train_std</span>    
    <span class="bp">self</span><span class="o">.</span><span class="n">x_test</span> <span class="o">=</span> <span class="n">x_test</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_cat</span> <span class="o">=</span> <span class="n">th</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">x_train</span><span class="p">,</span><span class="n">x_test</span><span class="p">),</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_train_mean</span> <span class="o">=</span> <span class="n">y_train_mean</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_train_std</span> <span class="o">=</span> <span class="n">y_train_std</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">preds</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1"># define GP likelihood</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span> <span class="o">=</span> <span class="n">gpth</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">GaussianLikelihood</span><span class="p">()</span>    
    
    <span class="c1"># GP model selection and init</span>
    <span class="k">assert</span> <span class="n">gp_model</span> <span class="o">==</span> <span class="s1">&#39;GPLinearRBF&#39;</span> <span class="ow">or</span> <span class="s1">&#39;GPLinearMatern&#39;</span><span class="p">,</span> <span class="s2">&quot;Error: GP model selected is not defined&quot;</span>
    <span class="k">if</span> <span class="n">gp_model</span> <span class="o">==</span> <span class="s1">&#39;GPLinearRBF&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">GPLinearRBF</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gp_model</span> <span class="o">==</span> <span class="s1">&#39;GPLinearMatern&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">GPLinearMatern</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
      
    <span class="c1"># training param</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">train_iter</span> <span class="o">=</span> <span class="n">train_iter</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">=</span> <span class="n">lr</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">th</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lr</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">loss_fn</span> <span class="o">=</span> <span class="n">gpth</span><span class="o">.</span><span class="n">mlls</span><span class="o">.</span><span class="n">ExactMarginalLogLikelihood</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>   
    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
    
    <span class="c1"># plots</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span>
      
  <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      training of gaussian process model to fit kernel parameters to data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">iter_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">train_iter</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
      <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="p">)</span>
      <span class="n">loss</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">loss_fn</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
      <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">iter_idx</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iter: </span><span class="si">{</span><span class="n">iter_idx</span><span class="si">}</span><span class="s2">, train_loss: </span><span class="si">{</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
  <span class="k">def</span> <span class="nf">prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      predict data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">th</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span> <span class="c1">#, gpth.settings.fast_pred_var():  </span>
      <span class="bp">self</span><span class="o">.</span><span class="n">preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_cat</span><span class="p">))</span>
      
  <span class="k">def</span> <span class="nf">denormalize_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      denormalize the output data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y_train_std</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train_mean</span>
  
  <span class="k">def</span> <span class="nf">denormalize_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      denormalize the input data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train_std</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train_mean</span>  
      
  <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      plot the data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">th</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
      
      <span class="c1"># extract time index dimension</span>
      <span class="n">xdim</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">xdim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span>
      <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
      <span class="k">if</span> <span class="n">xdim</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">xdim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">x_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denormalize_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="p">)</span>
        <span class="n">x_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denormalize_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_test</span><span class="p">)</span>
        <span class="n">x_cat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denormalize_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_cat</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">xdim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">x_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denormalize_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denormalize_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_test</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x_cat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denormalize_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_cat</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
        
      <span class="c1"># plot</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
      <span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denormalize_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preds</span><span class="o">.</span><span class="n">mean</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">preds</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.96</span><span class="p">)</span>
      <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denormalize_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preds</span><span class="o">.</span><span class="n">mean</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">preds</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.96</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_train</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train_min</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">denormalize_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="s1">&#39;k*&#39;</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_test</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train_min</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">denormalize_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_test</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="s1">&#39;r*&#39;</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_cat</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train_min</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">denormalize_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preds</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_cat</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train_min</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">lower</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">upper</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;train data&#39;</span><span class="p">,</span> <span class="s1">&#39;test data&#39;</span><span class="p">,</span> <span class="s1">&#39;predicted mean&#39;</span><span class="p">,</span> <span class="s1">&#39;predicted confidence 95%&#39;</span><span class="p">])</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time [days]&#39;</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;prediction&#39;</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;prediction&#39;</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>     
      
  <span class="k">def</span> <span class="nf">print_data_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      print shapes for debug purpose</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;data shapes:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;x_train: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;x_test: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">x_test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;x_cat: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">x_cat</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;y_train: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;y_test: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>  
    <span class="k">try</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;preds mean: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">preds</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="k">pass</span>

  <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      evaluation of predictions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">th</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
      <span class="c1"># data to evaluate</span>
      <span class="n">test_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denormalize_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_test</span><span class="p">)</span> 
      <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denormalize_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preds</span><span class="o">.</span><span class="n">mean</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_test</span><span class="p">):])</span>
      
      <span class="c1"># evaluate</span>
      <span class="n">error_mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
      <span class="n">error_rmse</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">error_mse</span><span class="p">)</span>
      <span class="n">error_abs</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
      <span class="n">avg_gt</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
      <span class="n">mse_percentage</span> <span class="o">=</span> <span class="n">error_rmse</span> <span class="o">/</span> <span class="n">avg_gt</span> <span class="o">*</span> <span class="mi">100</span>
      <span class="n">abs_percentage</span> <span class="o">=</span> <span class="n">error_abs</span> <span class="o">/</span> <span class="n">avg_gt</span> <span class="o">*</span> <span class="mi">100</span>
      
      <span class="c1"># print</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average of groundtruth: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">avg_gt</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test MSE: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">error_mse</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test RMSE: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">error_rmse</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE percentage error: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">mse_percentage</span><span class="p">,</span> <span class="s1">&#39;%&#39;</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test ABS: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">error_abs</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ABS percentage error: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">abs_percentage</span><span class="p">,</span> <span class="s1">&#39;%&#39;</span><span class="p">)</span>      
</pre></div>
</div>
</div>
</div>
<p>Init the training class for the Gaussian Process models</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pred_ncworld</span> <span class="o">=</span> <span class="n">GPTrainer</span><span class="p">(</span><span class="n">gp_model</span><span class="o">=</span><span class="s1">&#39;GPLinearRBF&#39;</span><span class="p">,</span> <span class="n">x_train</span><span class="o">=</span><span class="n">ds_ncworld</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">x_train_min</span><span class="o">=</span><span class="n">ds_ncworld</span><span class="o">.</span><span class="n">x_train_min</span><span class="p">,</span> <span class="n">x_train_mean</span><span class="o">=</span><span class="n">ds_ncworld</span><span class="o">.</span><span class="n">x_train_mean</span><span class="p">,</span> <span class="n">x_train_std</span><span class="o">=</span><span class="n">ds_ncworld</span><span class="o">.</span><span class="n">x_train_std</span><span class="p">,</span> <span class="n">x_test</span><span class="o">=</span><span class="n">ds_ncworld</span><span class="o">.</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="o">=</span><span class="n">ds_ncworld</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="o">=</span><span class="n">ds_ncworld</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_train_mean</span><span class="o">=</span><span class="n">ds_ncworld</span><span class="o">.</span><span class="n">y_train_mean</span><span class="p">,</span> <span class="n">y_train_std</span><span class="o">=</span><span class="n">ds_ncworld</span><span class="o">.</span><span class="n">y_train_std</span><span class="p">)</span>

<span class="n">pred_ndworld</span> <span class="o">=</span> <span class="n">GPTrainer</span><span class="p">(</span><span class="n">gp_model</span><span class="o">=</span><span class="s1">&#39;GPLinearRBF&#39;</span><span class="p">,</span> <span class="n">x_train</span><span class="o">=</span><span class="n">ds_ndworld</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">x_train_min</span><span class="o">=</span><span class="n">ds_ndworld</span><span class="o">.</span><span class="n">x_train_min</span><span class="p">,</span> <span class="n">x_train_mean</span><span class="o">=</span><span class="n">ds_ndworld</span><span class="o">.</span><span class="n">x_train_mean</span><span class="p">,</span> <span class="n">x_train_std</span><span class="o">=</span><span class="n">ds_ndworld</span><span class="o">.</span><span class="n">x_train_std</span><span class="p">,</span> <span class="n">x_test</span><span class="o">=</span><span class="n">ds_ndworld</span><span class="o">.</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="o">=</span><span class="n">ds_ndworld</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="o">=</span><span class="n">ds_ndworld</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_train_mean</span><span class="o">=</span><span class="n">ds_ndworld</span><span class="o">.</span><span class="n">y_train_mean</span><span class="p">,</span> <span class="n">y_train_std</span><span class="o">=</span><span class="n">ds_ndworld</span><span class="o">.</span><span class="n">y_train_std</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Training</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">training new cases prediction model&#39;</span><span class="p">)</span>
<span class="n">pred_ncworld</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">training new deaths prediction model&#39;</span><span class="p">)</span>
<span class="n">pred_ndworld</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>training new cases prediction model
/databricks/python/lib/python3.7/site-packages/torch/autograd/__init__.py:132: UserWarning: CUDA initialization: Found no NVIDIA driver on your system. Please check that you have an NVIDIA GPU and installed a driver from http://www.nvidia.com/Download/index.aspx (Triggered internally at  /pytorch/c10/cuda/CUDAFunctions.cpp:100.)
  allow_unreachable=True)  # allow_unreachable flag
Iter: 10, train_loss: 0.7546234130859375
Iter: 20, train_loss: 0.4275757968425751
Iter: 30, train_loss: 0.11226234585046768
Iter: 40, train_loss: -0.15334300696849823
Iter: 50, train_loss: -0.2943705916404724
Iter: 60, train_loss: -0.30030307173728943
Iter: 70, train_loss: -0.30076757073402405
Iter: 80, train_loss: -0.30838844180107117
Iter: 90, train_loss: -0.3079160749912262
Iter: 100, train_loss: -0.30836227536201477
Iter: 110, train_loss: -0.3085930645465851
Iter: 120, train_loss: -0.3085639178752899
Iter: 130, train_loss: -0.3086168169975281
Iter: 140, train_loss: -0.3086094558238983
Iter: 150, train_loss: -0.30860716104507446
Iter: 160, train_loss: -0.3086104691028595
Iter: 170, train_loss: -0.3086104691028595
Iter: 180, train_loss: -0.30861249566078186
Iter: 190, train_loss: -0.308610737323761
Iter: 200, train_loss: -0.30861350893974304
Iter: 210, train_loss: -0.3086123764514923
Iter: 220, train_loss: -0.3086145520210266
Iter: 230, train_loss: -0.30861225724220276
Iter: 240, train_loss: -0.3086118698120117
Iter: 250, train_loss: -0.30861696600914
Iter: 260, train_loss: -0.30861350893974304
Iter: 270, train_loss: -0.3086144030094147
Iter: 280, train_loss: -0.3086142838001251
Iter: 290, train_loss: -0.30861034989356995
Iter: 300, train_loss: -0.3086152970790863

training new deaths prediction model
Iter: 10, train_loss: 1.0905324220657349
Iter: 20, train_loss: 0.9422212243080139
Iter: 30, train_loss: 0.822321891784668
Iter: 40, train_loss: 0.7358468174934387
Iter: 50, train_loss: 0.6878499984741211
Iter: 60, train_loss: 0.6686744689941406
Iter: 70, train_loss: 0.6627503633499146
Iter: 80, train_loss: 0.6610774993896484
Iter: 90, train_loss: 0.6605528593063354
Iter: 100, train_loss: 0.6603661775588989
Iter: 110, train_loss: 0.6602908968925476
Iter: 120, train_loss: 0.6602528095245361
Iter: 130, train_loss: 0.660234272480011
Iter: 140, train_loss: 0.6602233648300171
Iter: 150, train_loss: 0.6602159142494202
Iter: 160, train_loss: 0.6602100133895874
Iter: 170, train_loss: 0.6602076292037964
Iter: 180, train_loss: 0.6602047085762024
Iter: 190, train_loss: 0.6602054238319397
Iter: 200, train_loss: 0.6602044701576233
Iter: 210, train_loss: 0.6602048277854919
Iter: 220, train_loss: 0.6602048277854919
Iter: 230, train_loss: 0.6602058410644531
Iter: 240, train_loss: 0.6602041721343994
Iter: 250, train_loss: 0.6602049469947815
Iter: 260, train_loss: 0.660204291343689
Iter: 270, train_loss: 0.660205602645874
Iter: 280, train_loss: 0.6602062582969666
Iter: 290, train_loss: 0.6602067351341248
Iter: 300, train_loss: 0.6602053046226501
</pre></div>
</div>
</div></blockquote>
<p>Prediction and plot</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pred_ncworld</span><span class="o">.</span><span class="n">prediction</span><span class="p">()</span>
<span class="n">pred_ncworld</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pred_ncworld</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;new cases smoothed&#39;</span><span class="p">)</span>
<span class="n">pred_ncworld</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;new cases smoothed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pred_ndworld</span><span class="o">.</span><span class="n">prediction</span><span class="p">()</span>
<span class="n">pred_ndworld</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pred_ndworld</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;new deaths smoothed&#39;</span><span class="p">)</span>
<span class="n">pred_ndworld</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;new deaths smoothed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="world-onestep-prediction">
<h2>3.2 World onestep prediction<a class="headerlink" href="#world-onestep-prediction" title="Permalink to this headline">Â¶</a></h2>
<p>To perform onestep ahead mean prediction, we define some additional
functions</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">onestep_prediction</span><span class="p">(</span><span class="n">dataset</span><span class="p">):</span>
  <span class="n">onestep</span> <span class="o">=</span> <span class="n">th</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">dataset</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">y_test</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># output vector</span>
  <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">y_test</span><span class="p">)):</span>
    
    <span class="c1"># define training and test data. Training data is iteratively, step by step, expanded by the use of test data</span>
    <span class="n">x_train</span> <span class="o">=</span> <span class="n">th</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">dataset</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">x_test</span><span class="p">[:</span><span class="n">idx</span><span class="p">]),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">x_test</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">x_test</span><span class="p">[</span><span class="n">idx</span><span class="p">:]</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">th</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">dataset</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">y_test</span><span class="p">[:</span><span class="n">idx</span><span class="p">]),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">y_test</span><span class="p">[</span><span class="n">idx</span><span class="p">:]</span>
    
    <span class="c1"># create a gaussian process model, train and make predictions</span>
    <span class="n">pred_model</span> <span class="o">=</span> <span class="n">GPTrainer</span><span class="p">(</span><span class="n">gp_model</span><span class="o">=</span><span class="s1">&#39;GPLinearRBF&#39;</span><span class="p">,</span> <span class="n">x_train</span><span class="o">=</span><span class="n">x_train</span><span class="p">,</span> <span class="n">x_train_min</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">x_train_min</span><span class="p">,</span> <span class="n">x_train_mean</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">x_train_mean</span><span class="p">,</span> <span class="n">x_train_std</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">x_train_std</span><span class="p">,</span> <span class="n">x_test</span><span class="o">=</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_train_mean</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">y_train_mean</span><span class="p">,</span> <span class="n">y_train_std</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">y_train_std</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pred_model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    <span class="n">pred_model</span><span class="o">.</span><span class="n">prediction</span><span class="p">()</span>
    
    <span class="c1"># store one step predictions</span>
    <span class="n">onestep</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">y_train</span><span class="p">)</span> <span class="o">+</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred_model</span><span class="o">.</span><span class="n">preds</span><span class="o">.</span><span class="n">mean</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">x_train</span><span class="p">)</span><span class="o">+</span><span class="n">idx</span><span class="p">]</span>

  <span class="c1"># plot results</span>
  <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pred_model</span><span class="o">.</span><span class="n">x_train_min</span> <span class="o">+</span> <span class="n">pred_model</span><span class="o">.</span><span class="n">denormalize_x</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">x_test</span><span class="p">),</span> <span class="n">pred_model</span><span class="o">.</span><span class="n">denormalize_y</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">y_test</span><span class="p">),</span><span class="s1">&#39;*r&#39;</span><span class="p">,</span> <span class="n">pred_model</span><span class="o">.</span><span class="n">x_train_min</span> <span class="o">+</span> <span class="n">pred_model</span><span class="o">.</span><span class="n">denormalize_x</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">x_test</span><span class="p">),</span> <span class="n">pred_model</span><span class="o">.</span><span class="n">denormalize_y</span><span class="p">(</span><span class="n">onestep</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">y_train</span><span class="p">):]),</span><span class="s1">&#39;k*&#39;</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;test data&#39;</span><span class="p">,</span> <span class="s1">&#39;prediction mean&#39;</span><span class="p">])</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time [days]&#39;</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;prediction mean&#39;</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;one step ahead prediction&#39;</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>   
  
  <span class="c1"># return onestep prediction</span>
  <span class="k">return</span> <span class="n">onestep</span>
</pre></div>
</div>
</div>
</div>
<p>We iteratively predict the next one step ahead</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onestep_pred_ncworld</span> <span class="o">=</span> <span class="n">onestep_prediction</span><span class="p">(</span><span class="n">ds_ncworld</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onestep_pred_ndworld</span> <span class="o">=</span> <span class="n">onestep_prediction</span><span class="p">(</span><span class="n">ds_ndworld</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="sweden-multistep-prediction">
<h2>3.3 Sweden multistep prediction<a class="headerlink" href="#sweden-multistep-prediction" title="Permalink to this headline">Â¶</a></h2>
<p>Use class to convert dataframes to numpy arrays for further processing.
Note, the conversion may take a while.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ncswe</span> <span class="o">=</span> <span class="n">GPDataSet</span><span class="p">(</span><span class="n">df_ncdenswe_train</span><span class="p">,</span> <span class="n">df_ncdenswe_test</span><span class="p">,</span> <span class="n">datacol</span> <span class="o">=</span> <span class="s1">&#39;new_cases_smoothed&#39;</span><span class="p">,</span> <span class="n">filterloc</span> <span class="o">=</span> <span class="s1">&#39;Sweden&#39;</span><span class="p">,</span> <span class="n">add_input</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">ds_ndswe</span> <span class="o">=</span> <span class="n">GPDataSet</span><span class="p">(</span><span class="n">df_nddenswe_train</span><span class="p">,</span> <span class="n">df_nddenswe_test</span><span class="p">,</span> <span class="n">datacol</span> <span class="o">=</span> <span class="s1">&#39;new_deaths_smoothed&#39;</span><span class="p">,</span> <span class="n">filterloc</span> <span class="o">=</span> <span class="s1">&#39;Sweden&#39;</span><span class="p">,</span> <span class="n">add_input</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">ds_ncswe</span><span class="o">.</span><span class="n">convert_to_numpy</span><span class="p">()</span>
<span class="n">ds_ndswe</span><span class="o">.</span><span class="n">convert_to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Plot data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ncswe</span><span class="o">.</span><span class="n">plot_numpy_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ndswe</span><span class="o">.</span><span class="n">plot_numpy_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Process data by subsampling, reducing data window and normalize data.
The gaussian process model is a so called non parametric model and will
be mainly based on the data points. As such, to reduce the computation
and the complexity of the model, we subsample and reduce the number of
datapoints.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ncswe</span><span class="o">.</span><span class="n">process_numpy_data</span><span class="p">(</span><span class="n">nth_subsample</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">window_red</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">)</span>
<span class="n">ds_ndswe</span><span class="o">.</span><span class="n">process_numpy_data</span><span class="p">(</span><span class="n">nth_subsample</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">window_red</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Plot processed data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ncswe</span><span class="o">.</span><span class="n">plot_reduced_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ndswe</span><span class="o">.</span><span class="n">plot_reduced_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Init the training class for the Gaussian Process models</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pred_ncswe</span> <span class="o">=</span> <span class="n">GPTrainer</span><span class="p">(</span><span class="n">gp_model</span><span class="o">=</span><span class="s1">&#39;GPLinearRBF&#39;</span><span class="p">,</span> <span class="n">x_train</span><span class="o">=</span><span class="n">ds_ncswe</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">x_train_min</span><span class="o">=</span><span class="n">ds_ncswe</span><span class="o">.</span><span class="n">x_train_min</span><span class="p">,</span> <span class="n">x_train_mean</span><span class="o">=</span><span class="n">ds_ncswe</span><span class="o">.</span><span class="n">x_train_mean</span><span class="p">,</span> <span class="n">x_train_std</span><span class="o">=</span><span class="n">ds_ncswe</span><span class="o">.</span><span class="n">x_train_std</span><span class="p">,</span> <span class="n">x_test</span><span class="o">=</span><span class="n">ds_ncswe</span><span class="o">.</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="o">=</span><span class="n">ds_ncswe</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="o">=</span><span class="n">ds_ncswe</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_train_mean</span><span class="o">=</span><span class="n">ds_ncswe</span><span class="o">.</span><span class="n">y_train_mean</span><span class="p">,</span> <span class="n">y_train_std</span><span class="o">=</span><span class="n">ds_ncswe</span><span class="o">.</span><span class="n">y_train_std</span><span class="p">)</span>

<span class="n">pred_ndswe</span> <span class="o">=</span> <span class="n">GPTrainer</span><span class="p">(</span><span class="n">gp_model</span><span class="o">=</span><span class="s1">&#39;GPLinearRBF&#39;</span><span class="p">,</span> <span class="n">x_train</span><span class="o">=</span><span class="n">ds_ndswe</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">x_train_min</span><span class="o">=</span><span class="n">ds_ndswe</span><span class="o">.</span><span class="n">x_train_min</span><span class="p">,</span> <span class="n">x_train_mean</span><span class="o">=</span><span class="n">ds_ncswe</span><span class="o">.</span><span class="n">x_train_mean</span><span class="p">,</span> <span class="n">x_train_std</span><span class="o">=</span><span class="n">ds_ncswe</span><span class="o">.</span><span class="n">x_train_std</span><span class="p">,</span> <span class="n">x_test</span><span class="o">=</span><span class="n">ds_ndswe</span><span class="o">.</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="o">=</span><span class="n">ds_ndswe</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="o">=</span><span class="n">ds_ndswe</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_train_mean</span><span class="o">=</span><span class="n">ds_ndswe</span><span class="o">.</span><span class="n">y_train_mean</span><span class="p">,</span> <span class="n">y_train_std</span><span class="o">=</span><span class="n">ds_ndswe</span><span class="o">.</span><span class="n">y_train_std</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Training</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">training new cases prediction model&#39;</span><span class="p">)</span>
<span class="n">pred_ncswe</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">training new deaths prediction model&#39;</span><span class="p">)</span>
<span class="n">pred_ndswe</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>training new cases prediction model
Iter: 10, train_loss: 0.8349927663803101
Iter: 20, train_loss: 0.5855213403701782
Iter: 30, train_loss: 0.3725060224533081
Iter: 40, train_loss: 0.2526648938655853
Iter: 50, train_loss: 0.23845908045768738
Iter: 60, train_loss: 0.2379620224237442
Iter: 70, train_loss: 0.23536014556884766
Iter: 80, train_loss: 0.234043687582016
Iter: 90, train_loss: 0.23412634432315826
Iter: 100, train_loss: 0.23409061133861542
Iter: 110, train_loss: 0.23400363326072693
Iter: 120, train_loss: 0.2339954972267151
Iter: 130, train_loss: 0.2339944839477539
Iter: 140, train_loss: 0.23399288952350616
Iter: 150, train_loss: 0.2339918166399002
Iter: 160, train_loss: 0.2339887022972107
Iter: 170, train_loss: 0.2339930236339569
Iter: 180, train_loss: 0.2339915633201599
Iter: 190, train_loss: 0.2339925765991211
Iter: 200, train_loss: 0.2339947372674942
Iter: 210, train_loss: 0.23399461805820465
Iter: 220, train_loss: 0.23399263620376587
Iter: 230, train_loss: 0.2339930236339569
Iter: 240, train_loss: 0.2339915633201599
Iter: 250, train_loss: 0.23399244248867035
Iter: 260, train_loss: 0.23398932814598083
Iter: 270, train_loss: 0.23399288952350616
Iter: 280, train_loss: 0.2339920699596405
Iter: 290, train_loss: 0.23399271070957184
Iter: 300, train_loss: 0.23399384319782257

training new deaths prediction model
Iter: 10, train_loss: 1.2736952304840088
Iter: 20, train_loss: 1.2659318447113037
Iter: 30, train_loss: 1.2641785144805908
Iter: 40, train_loss: 1.2638046741485596
Iter: 50, train_loss: 1.2635420560836792
Iter: 60, train_loss: 1.2633696794509888
Iter: 70, train_loss: 1.2632778882980347
Iter: 80, train_loss: 1.263228178024292
Iter: 90, train_loss: 1.2631932497024536
Iter: 100, train_loss: 1.2631678581237793
Iter: 110, train_loss: 1.2631479501724243
Iter: 120, train_loss: 1.2631317377090454
Iter: 130, train_loss: 1.2631182670593262
Iter: 140, train_loss: 1.2631065845489502
Iter: 150, train_loss: 1.2630963325500488
Iter: 160, train_loss: 1.263087511062622
Iter: 170, train_loss: 1.2630798816680908
Iter: 180, train_loss: 1.2630729675292969
Iter: 190, train_loss: 1.2630666494369507
Iter: 200, train_loss: 1.263061285018921
Iter: 210, train_loss: 1.2630563974380493
Iter: 220, train_loss: 1.2630518674850464
Iter: 230, train_loss: 1.2630479335784912
Iter: 240, train_loss: 1.263043999671936
Iter: 250, train_loss: 1.2630406618118286
Iter: 260, train_loss: 1.2630375623703003
Iter: 270, train_loss: 1.263034701347351
Iter: 280, train_loss: 1.263032078742981
Iter: 290, train_loss: 1.2630293369293213
Iter: 300, train_loss: 1.2630271911621094
</pre></div>
</div>
</div></blockquote>
<p>Prediction and plot</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pred_ncswe</span><span class="o">.</span><span class="n">prediction</span><span class="p">()</span>
<span class="n">pred_ncswe</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pred_ncswe</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;new cases smoothed&#39;</span><span class="p">)</span>
<span class="n">pred_ncswe</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;new cases smoothed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pred_ndswe</span><span class="o">.</span><span class="n">prediction</span><span class="p">()</span>
<span class="n">pred_ndswe</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pred_ndswe</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;new deaths smoothed&#39;</span><span class="p">)</span>
<span class="n">pred_ndswe</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;new deaths smoothed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="sweden-onestep-prediction">
<h2>3.4 Sweden onestep prediction<a class="headerlink" href="#sweden-onestep-prediction" title="Permalink to this headline">Â¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onestep_pred_ncswe</span> <span class="o">=</span> <span class="n">onestep_prediction</span><span class="p">(</span><span class="n">ds_ncswe</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onestep_pred_ndswe</span> <span class="o">=</span> <span class="n">onestep_prediction</span><span class="p">(</span><span class="n">ds_ndswe</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="sweden-multistep-prediction-with-additional-data-input-from-neighbouring-country">
<h2>3.5 Sweden multistep prediction with additional data input from neighbouring country<a class="headerlink" href="#sweden-multistep-prediction-with-additional-data-input-from-neighbouring-country" title="Permalink to this headline">Â¶</a></h2>
<p>Assuming we knew the results from a neighbouring country and if data is
correlated, we could presumably improve the prediction</p>
<p>Plot resulting data used for prediction. Both plots appears to follow a
form of trend.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ncswex</span> <span class="o">=</span> <span class="n">GPDataSet</span><span class="p">(</span><span class="n">df_ncdenswe_train</span><span class="p">,</span> <span class="n">df_ncdenswe_test</span><span class="p">,</span> <span class="n">datacol</span> <span class="o">=</span> <span class="s1">&#39;new_cases_smoothed&#39;</span><span class="p">,</span> <span class="n">filterloc</span> <span class="o">=</span> <span class="s1">&#39;Sweden&#39;</span><span class="p">,</span> <span class="n">add_input</span><span class="o">=</span><span class="s1">&#39;Denmark&#39;</span><span class="p">)</span>
<span class="n">ds_ndswex</span> <span class="o">=</span> <span class="n">GPDataSet</span><span class="p">(</span><span class="n">df_nddenswe_train</span><span class="p">,</span> <span class="n">df_nddenswe_test</span><span class="p">,</span> <span class="n">datacol</span> <span class="o">=</span> <span class="s1">&#39;new_deaths_smoothed&#39;</span><span class="p">,</span> <span class="n">filterloc</span> <span class="o">=</span> <span class="s1">&#39;Sweden&#39;</span><span class="p">,</span> <span class="n">add_input</span><span class="o">=</span><span class="s1">&#39;Denmark&#39;</span><span class="p">)</span>
<span class="n">ds_ncswex</span><span class="o">.</span><span class="n">convert_to_numpy</span><span class="p">()</span>
<span class="n">ds_ndswex</span><span class="o">.</span><span class="n">convert_to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Plot data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ncswex</span><span class="o">.</span><span class="n">plot_numpy_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ndswex</span><span class="o">.</span><span class="n">plot_numpy_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Process data by subsampling, reducing data window and normalize data.
The gaussian process model is a so called non parametric model and will
be mainly based on the data points. As such, to reduce the computation
and the complexity of the model, we subsample and reduce the number of
datapoints.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ncswex</span><span class="o">.</span><span class="n">process_numpy_data</span><span class="p">(</span><span class="n">nth_subsample</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">window_red</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">)</span>
<span class="n">ds_ndswex</span><span class="o">.</span><span class="n">process_numpy_data</span><span class="p">(</span><span class="n">nth_subsample</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">window_red</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Plot processed data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ncswex</span><span class="o">.</span><span class="n">plot_reduced_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ndswex</span><span class="o">.</span><span class="n">plot_reduced_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Init the training class for the Gaussian Process models</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pred_ncswex</span> <span class="o">=</span> <span class="n">GPTrainer</span><span class="p">(</span><span class="n">gp_model</span><span class="o">=</span><span class="s1">&#39;GPLinearRBF&#39;</span><span class="p">,</span> <span class="n">x_train</span><span class="o">=</span><span class="n">ds_ncswex</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">x_train_min</span><span class="o">=</span><span class="n">ds_ncswex</span><span class="o">.</span><span class="n">x_train_min</span><span class="p">,</span> <span class="n">x_train_mean</span><span class="o">=</span><span class="n">ds_ncswex</span><span class="o">.</span><span class="n">x_train_mean</span><span class="p">,</span> <span class="n">x_train_std</span><span class="o">=</span><span class="n">ds_ncswex</span><span class="o">.</span><span class="n">x_train_std</span><span class="p">,</span> <span class="n">x_test</span><span class="o">=</span><span class="n">ds_ncswex</span><span class="o">.</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="o">=</span><span class="n">ds_ncswex</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="o">=</span><span class="n">ds_ncswex</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_train_mean</span><span class="o">=</span><span class="n">ds_ncswex</span><span class="o">.</span><span class="n">y_train_mean</span><span class="p">,</span> <span class="n">y_train_std</span><span class="o">=</span><span class="n">ds_ncswex</span><span class="o">.</span><span class="n">y_train_std</span><span class="p">)</span>

<span class="n">pred_ndswex</span> <span class="o">=</span> <span class="n">GPTrainer</span><span class="p">(</span><span class="n">gp_model</span><span class="o">=</span><span class="s1">&#39;GPLinearRBF&#39;</span><span class="p">,</span> <span class="n">x_train</span><span class="o">=</span><span class="n">ds_ndswex</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">x_train_min</span><span class="o">=</span><span class="n">ds_ndswex</span><span class="o">.</span><span class="n">x_train_min</span><span class="p">,</span> <span class="n">x_train_mean</span><span class="o">=</span><span class="n">ds_ndswex</span><span class="o">.</span><span class="n">x_train_mean</span><span class="p">,</span> <span class="n">x_train_std</span><span class="o">=</span><span class="n">ds_ndswex</span><span class="o">.</span><span class="n">x_train_std</span><span class="p">,</span> <span class="n">x_test</span><span class="o">=</span><span class="n">ds_ndswex</span><span class="o">.</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="o">=</span><span class="n">ds_ndswex</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="o">=</span><span class="n">ds_ndswex</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_train_mean</span><span class="o">=</span><span class="n">ds_ndswex</span><span class="o">.</span><span class="n">y_train_mean</span><span class="p">,</span> <span class="n">y_train_std</span><span class="o">=</span><span class="n">ds_ndswex</span><span class="o">.</span><span class="n">y_train_std</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Training</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">training new cases prediction model&#39;</span><span class="p">)</span>
<span class="n">pred_ncswex</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">training new deaths prediction model&#39;</span><span class="p">)</span>
<span class="n">pred_ndswex</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>training new cases prediction model
Iter: 10, train_loss: 0.8944303393363953
Iter: 20, train_loss: 0.7347151637077332
Iter: 30, train_loss: 0.6328760981559753
Iter: 40, train_loss: 0.4474466145038605
Iter: 50, train_loss: 0.15617185831069946
Iter: 60, train_loss: -0.015161959454417229
Iter: 70, train_loss: -0.028500746935606003
Iter: 80, train_loss: -0.049165789037942886
Iter: 90, train_loss: -0.05050474777817726
Iter: 100, train_loss: -0.05421492084860802
Iter: 110, train_loss: -0.05606149137020111
Iter: 120, train_loss: -0.0588647834956646
Iter: 130, train_loss: -0.06143894046545029
Iter: 140, train_loss: -0.06341520696878433
Iter: 150, train_loss: -0.06587778776884079
Iter: 160, train_loss: -0.06713174283504486
Iter: 170, train_loss: -0.06902586668729782
Iter: 180, train_loss: -0.07032934576272964
Iter: 190, train_loss: -0.0719415694475174
Iter: 200, train_loss: -0.07307198643684387
Iter: 210, train_loss: -0.07436548918485641
Iter: 220, train_loss: -0.07486489415168762
Iter: 230, train_loss: -0.07584095001220703
Iter: 240, train_loss: -0.07697887718677521
Iter: 250, train_loss: -0.07766450196504593
Iter: 260, train_loss: -0.07864208519458771
Iter: 270, train_loss: -0.07991237938404083
Iter: 280, train_loss: -0.08046308904886246
Iter: 290, train_loss: -0.08109690248966217
Iter: 300, train_loss: -0.081480473279953

training new deaths prediction model
Iter: 10, train_loss: 1.2888128757476807
Iter: 20, train_loss: 1.275627851486206
Iter: 30, train_loss: 1.2696713209152222
Iter: 40, train_loss: 1.2672677040100098
Iter: 50, train_loss: 1.2659194469451904
Iter: 60, train_loss: 1.2652630805969238
Iter: 70, train_loss: 1.2648776769638062
Iter: 80, train_loss: 1.2646286487579346
Iter: 90, train_loss: 1.2644517421722412
Iter: 100, train_loss: 1.2643193006515503
Iter: 110, train_loss: 1.2642160654067993
Iter: 120, train_loss: 1.2641332149505615
Iter: 130, train_loss: 1.2640646696090698
Iter: 140, train_loss: 1.2640074491500854
Iter: 150, train_loss: 1.2639591693878174
Iter: 160, train_loss: 1.2639178037643433
Iter: 170, train_loss: 1.2638816833496094
Iter: 180, train_loss: 1.263850450515747
Iter: 190, train_loss: 1.2638229131698608
Iter: 200, train_loss: 1.2637988328933716
Iter: 210, train_loss: 1.2637768983840942
Iter: 220, train_loss: 1.2637579441070557
Iter: 230, train_loss: 1.2637404203414917
Iter: 240, train_loss: 1.2637248039245605
Iter: 250, train_loss: 1.263710379600525
Iter: 260, train_loss: 1.2636975049972534
Iter: 270, train_loss: 1.2636858224868774
Iter: 280, train_loss: 1.263675332069397
Iter: 290, train_loss: 1.2636650800704956
Iter: 300, train_loss: 1.2636560201644897
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pred_ncswex</span><span class="o">.</span><span class="n">prediction</span><span class="p">()</span>
<span class="n">pred_ncswex</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pred_ncswex</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;new cases smoothed&#39;</span><span class="p">)</span>
<span class="n">pred_ncswex</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;new cases smoothed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pred_ndswex</span><span class="o">.</span><span class="n">prediction</span><span class="p">()</span>
<span class="n">pred_ndswex</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pred_ndswex</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;new deaths smoothed&#39;</span><span class="p">)</span>
<span class="n">pred_ndswex</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;new deaths smoothed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ol class="simple">
<li><p>Evaluation</p></li>
</ol>
</div>
<hr class="docutils" />
<div class="section" id="world-multistep">
<h2>4.1 World multistep<a class="headerlink" href="#world-multistep" title="Permalink to this headline">Â¶</a></h2>
<p>Evaluation of new cases smoothed</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pred_ncworld</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Average of groundtruth: 554788.000
Test MSE: 1850106112.000
Test RMSE: 43012.860
RMSE percentage error: 7.753 %
Test ABS: 33457.289
ABS percentage error: 6.031 %
</pre></div>
</div>
</div></blockquote>
<p>Evaluation of new deaths smoothed</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pred_ndworld</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Average of groundtruth: 8842.582
Test MSE: 8629836.000
Test RMSE: 2937.658
RMSE percentage error: 33.222 %
Test ABS: 2727.578
ABS percentage error: 30.846 %
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="world-onestep">
<h2>4.2 World onestep<a class="headerlink" href="#world-onestep" title="Permalink to this headline">Â¶</a></h2>
<p>To evaluate the onestep ahead prediction, we define an additional
function</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">prediction</span><span class="p">):</span>
  <span class="k">with</span> <span class="n">th</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>    
    <span class="c1"># evaluate</span>
    <span class="n">error_mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">prediction</span><span class="p">)</span>
    <span class="n">error_rmse</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">error_mse</span><span class="p">)</span>
    <span class="n">error_abs</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">prediction</span><span class="p">)</span>
    <span class="n">avg_gt</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
    <span class="n">mse_percentage</span> <span class="o">=</span> <span class="n">error_rmse</span> <span class="o">/</span> <span class="n">avg_gt</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">abs_percentage</span> <span class="o">=</span> <span class="n">error_abs</span> <span class="o">/</span> <span class="n">avg_gt</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="c1"># print</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average of groundtruth: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">avg_gt</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test MSE: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">error_mse</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test RMSE: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">error_rmse</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE percentage error: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">mse_percentage</span><span class="p">,</span> <span class="s1">&#39;%&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test ABS: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">error_abs</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ABS percentage error: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">abs_percentage</span><span class="p">,</span> <span class="s1">&#39;%&#39;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<p>Evaluation of new cases smoothed</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># data to evaluate</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pred_ncworld</span><span class="o">.</span><span class="n">denormalize_y</span><span class="p">(</span><span class="n">ds_ncworld</span><span class="o">.</span><span class="n">y_test</span><span class="p">)</span> 
<span class="n">preds</span> <span class="o">=</span> <span class="n">pred_ncworld</span><span class="o">.</span><span class="n">denormalize_y</span><span class="p">(</span><span class="n">onestep_pred_ncworld</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_ncworld</span><span class="o">.</span><span class="n">y_test</span><span class="p">):])</span>
<span class="n">evaluate</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Average of groundtruth: 554788.000
Test MSE: 38076252.000
Test RMSE: 6170.596
RMSE percentage error: 1.112 %
Test ABS: 4394.894
ABS percentage error: 0.792 %
</pre></div>
</div>
</div></blockquote>
<p>Evaluation of new deaths smoothed</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># data to evaluate</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pred_ndworld</span><span class="o">.</span><span class="n">denormalize_y</span><span class="p">(</span><span class="n">ds_ndworld</span><span class="o">.</span><span class="n">y_test</span><span class="p">)</span> 
<span class="n">preds</span> <span class="o">=</span> <span class="n">pred_ndworld</span><span class="o">.</span><span class="n">denormalize_y</span><span class="p">(</span><span class="n">onestep_pred_ndworld</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_ndworld</span><span class="o">.</span><span class="n">y_test</span><span class="p">):])</span>
<span class="n">evaluate</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Average of groundtruth: 8842.582
Test MSE: 29195.436
Test RMSE: 170.867
RMSE percentage error: 1.932 %
Test ABS: 137.978
ABS percentage error: 1.560 %
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="sweden-multistep">
<h2>4.2 Sweden multistep<a class="headerlink" href="#sweden-multistep" title="Permalink to this headline">Â¶</a></h2>
<p>Evaluation of new cases smoothed</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pred_ncswe</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Average of groundtruth: 4238.664
Test MSE: 4737463.500
Test RMSE: 2176.572
RMSE percentage error: 51.350 %
Test ABS: 2068.833
ABS percentage error: 48.809 %
</pre></div>
</div>
</div></blockquote>
<p>Evaluation of new deaths smoothed</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pred_ndswe</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Average of groundtruth: 26.254
Test MSE: 755.362
Test RMSE: 27.484
RMSE percentage error: 104.686 %
Test ABS: 22.457
ABS percentage error: 85.540 %
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="sweden-onestep">
<h2>4.4 Sweden onestep<a class="headerlink" href="#sweden-onestep" title="Permalink to this headline">Â¶</a></h2>
<p>Evaluation of new cases smoothed</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># data to evaluate</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pred_ncswe</span><span class="o">.</span><span class="n">denormalize_y</span><span class="p">(</span><span class="n">ds_ncswe</span><span class="o">.</span><span class="n">y_test</span><span class="p">)</span> 
<span class="n">preds</span> <span class="o">=</span> <span class="n">pred_ncswe</span><span class="o">.</span><span class="n">denormalize_y</span><span class="p">(</span><span class="n">onestep_pred_ncswe</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_ncswe</span><span class="o">.</span><span class="n">y_test</span><span class="p">):])</span>
<span class="n">evaluate</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Average of groundtruth: 4238.664
Test MSE: 77977.289
Test RMSE: 279.244
RMSE percentage error: 6.588 %
Test ABS: 235.829
ABS percentage error: 5.564 %
</pre></div>
</div>
</div></blockquote>
<p>Evaluation of new deaths smoothed</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># data to evaluate</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pred_ndswe</span><span class="o">.</span><span class="n">denormalize_y</span><span class="p">(</span><span class="n">ds_ndswe</span><span class="o">.</span><span class="n">y_test</span><span class="p">)</span> 
<span class="n">preds</span> <span class="o">=</span> <span class="n">pred_ndswe</span><span class="o">.</span><span class="n">denormalize_y</span><span class="p">(</span><span class="n">onestep_pred_ndswe</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_ndswe</span><span class="o">.</span><span class="n">y_test</span><span class="p">):])</span>
<span class="n">evaluate</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Average of groundtruth: 26.254
Test MSE: 33.230
Test RMSE: 5.765
RMSE percentage error: 21.957 %
Test ABS: 3.928
ABS percentage error: 14.963 %
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="sweden-multistep-with-additional-information">
<h2>4.4 Sweden multistep with additional information<a class="headerlink" href="#sweden-multistep-with-additional-information" title="Permalink to this headline">Â¶</a></h2>
<p>Evaluation of new cases smoothed</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pred_ncswex</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Average of groundtruth: 4238.664
Test MSE: 2658296.750
Test RMSE: 1630.428
RMSE percentage error: 38.466 %
Test ABS: 1537.534
ABS percentage error: 36.274 %
</pre></div>
</div>
</div></blockquote>
<p>Evaluation of new deaths smoothed</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pred_ndswex</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Average of groundtruth: 26.254
Test MSE: 756.587
Test RMSE: 27.506
RMSE percentage error: 104.771 %
Test ABS: 22.476
ABS percentage error: 85.612 %
</pre></div>
</div>
</div></blockquote>
<ol class="simple">
<li><p>Conclusions and reflections</p></li>
</ol>
<hr class="docutils" />
<p>Predictions using gaussian processes were made for both new cases
smoothed and new deaths smoothed. This included an aggregation of many
countries within the world as well as for Sweden. Making single step
ahead predictions resulted naturally in smaller errors compared to the
multistep predictions. The multistep prediction for Sweden could be
improved for new cases smoothed using correlated data from a
neighbouring country.</p>
<p>We believe the Gaussian process model is a valuable tool for making
predictions. With this work, we would like to highlight that the data
points and kernel chosen for the Gaussian process heavily biases the
model and strongly influences the predictions. In this project, we
selected a combination of a linear kernel and a radial basis function.
The reason being that there is a trend in the data and that nearby data
points should be more similar than data points further away. By
inspecting the data carefully, a more optimal kernel could likely be
selected. Also, the confidence intervall provided with the gaussian
process model is based on that the kernel is correctly representing the
underlying distribution of data.</p>
<p>In terms of scalability, the predictions are somewhat scalable as a user
can define a window of data for making the predictions. Furthermore, GPU
support could be included and approximations to the gaussian process
model could be made.</p>
<p>Compared to the ARIMA model, the gaussian process model performed in
most cases slightly worse. However, this may be due to the selection of
data points and kernel considering that the gaussian process model is
heavily biased by these choices. One reflection is that if one
approximately knows the distribution of the underlying data, a gaussian
process model with a proper selected kernel may be a good choice.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./000_0-sds-3-x-projects/student-project-12_group-CovidPandemic"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="07_DataPredicton_ARIMA.html" title="previous page">Prediction with Time Series model - ARIMA</a>
    <a class='right-next' id="next-link" href="../student-project-13_group-Genomics/01_1000genomes.html" title="next page">Genomics Analysis with Glow and Spark</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By ScaDaMaLe Team<br/>
        
            &copy; Copyright 2020 Creative Commons Zero v1.0 Universal.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>