<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>029_Viz_x_VizNetworkFunction - sds-3.x/ScaDaMaLe</title>


        <!-- Custom HTML head -->

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../scroll-mdbook-outputs.css">

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../contents/000_3-sds-3-x-st/024_SparkStreamingIntro.html">024_SparkStreamingIntro</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_3-sds-3-x-st/025_0_getTwitterDeveloperCredentials.html">025_0_getTwitterDeveloperCredentials</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_3-sds-3-x-st/025_a_extendedTwitterUtils2run.html">025_a_extendedTwitterUtils2run</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_3-sds-3-x-st/025_b_TTTDFfunctions.html">025_b_TTTDFfunctions</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_3-sds-3-x-st/025_c_extendedTwitterUtils2runWithLangs.html">025_c_extendedTwitterUtils2runWithLangs</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_3-sds-3-x-st/026_TweetCollector.html">026_TweetCollector</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_3-sds-3-x-st/027_TweetCollectorTrackAndFollow.html">027_TweetCollectorTrackAndFollow</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_3-sds-3-x-st/028_TweetHashtagCount.html">028_TweetHashtagCount</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_3-sds-3-x-st/029_TweetLanguageClassifier.html">029_TweetLanguageClassifier</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_3-sds-3-x-st/029_Viz_0_TwitterInteractiveVizualisations.html">029_Viz_0_TwitterInteractiveVizualisations</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_3-sds-3-x-st/029_Viz_1_GraphNetworkTimeline.html">029_Viz_1_GraphNetworkTimeline</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_3-sds-3-x-st/029_Viz_2_CoSENSE_EmotionalDimensions.html">029_Viz_2_CoSENSE_EmotionalDimensions</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_3-sds-3-x-st/029_Viz_x_VizGraphFunction.html">029_Viz_x_VizGraphFunction</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_3-sds-3-x-st/029_Viz_x_VizNetworkFunction.html" class="active">029_Viz_x_VizNetworkFunction</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_3-sds-3-x-st/029_Viz_x_VizTimelineFunction.html">029_Viz_x_VizTimelineFunction</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">sds-3.x/ScaDaMaLe</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div class="cell markdown">
<p>ScaDaMaLe Course <a href="https://lamastex.github.io/scalable-data-science/sds/3/x/">site</a> and <a href="https://lamastex.github.io/ScaDaMaLe/index.html">book</a></p>
</div>
<div class="cell markdown">
<h1 id="function-for-visualizing-a-twitter-network"><a class="header" href="#function-for-visualizing-a-twitter-network">Function for visualizing a Twitter network</a></h1>
<p>by Olof Björck, Joakim Johansson, Rania Sahioun, Raazesh Sainudiin and Ivan Sadikov</p>
<p>This is part of <em>Project MEP: Meme Evolution Programme</em> and supported by databricks, AWS and a Swedish VR grant.</p>
<pre><code>Copyright 2016-2020 Olof Björck, Joakim Johansson, Rania Sahioun, Ivan Sadikov and Raazesh Sainudiin

Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</code></pre>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">import org.apache.spark.sql.DataFrame
import org.apache.spark.sql.functions._

/** Displays an interactive visualization of a Twitter network.
 *
 *  This function takes a DataFrame from TTTDFfunctions function tweetsDF2TTTDF()
 *  and displays it in an interactive visualization. The DataFrame content should
 *  be a collection of Twitter users.
 *  
 *  Visualization description:
 *
 *  This is a visualization of a Twitter network. Each circle represents a Twitter 
 *  user (that is, a unique Twitter account). The color of the user circle represents 
 *  how many followers the user has from blue (fewest) to red (most). The radius of 
 *  the user circle also represents how many followers the user has from small radius 
 *  (fewest) to large radius (most) on a log scale. The x-axis shows the number of 
 *  Retweets of a user within the Twitter network (that is, the number of times the 
 *  user was Retweeted by users in this specific Twitter network). The y-axis shows 
 *  the number of unique Retweeters within the Twitter network (that is, the number 
 *  of unique users in this specific Twitter network that Retweeted a user). If you 
 *  hover over a user circle, the user screen name (as specified in the data) will 
 *  appear by the user circle and the user circle you're hovering will become enlarged.
 *  
 *  @param TTTDF A DataFrame from TTTDFfunctions function tweetsDF2TTTDF() containing
 *               the data to be displayed.
 *  @param width The display width in pixels.
 *  @param height The display height in pixels.
 */
def visualizeNetwork(TTTDF: DataFrame, width: Int = 900, height: Int = 400): Unit = {
  
  // Get all retweets and their weights (weights == 1 as we haven't done anything yet)
  val RTNetworkDF = TTTDF.filter($&quot;TweetType&quot;===&quot;ReTweet&quot;).select(&quot;OPostUserIdinRT&quot;,&quot;CPostUserId&quot;,&quot;Weight&quot;)
  
  // Get all (directed) retweet tuples
  val weightedRTNetworkDF = RTNetworkDF
                            .groupBy(&quot;OPostUserIdinRT&quot;,&quot;CPostUserId&quot;)
                            .agg(sum(&quot;Weight&quot;).as(&quot;Weight&quot;))
                            .orderBy($&quot;Weight&quot;.desc)
  
  // Get the out degree of each user. That is, get only the number of times a user is retweeted. We're now losing the tuples.
  val outDegreeOfOPostUserIdinRTNetwork = weightedRTNetworkDF
                                          .select(&quot;OPostUserIdinRT&quot;,&quot;Weight&quot;)
                                          .groupBy(&quot;OPostUserIdinRT&quot;)
                                          .agg(sum(&quot;Weight&quot;).as(&quot;Weight&quot;))
                                          .orderBy($&quot;Weight&quot;.desc)
  
  // Get number of unique retweeters (out degree neighborhood):
  // Use weightedRTNetwork, drop weight, add new weight of 1. 
  // We got all the retweet tuples with a weight of 1, then group by UserID to count number of unique retweeters
  val outNgbhdOfOPostUserIdinRTNetwork = weightedRTNetworkDF
                                          .drop(&quot;Weight&quot;)
                                          .withColumn(&quot;Weight&quot;,lit(1L))
                                          .groupBy(&quot;OPostUserIdinRT&quot;)
                                          .agg(sum(&quot;Weight&quot;).as(&quot;Weight&quot;))
                                          .orderBy($&quot;Weight&quot;.desc) 
  
  // Combine retweets and retweeters count and rename columns
  val tweetsAndRetweets = outDegreeOfOPostUserIdinRTNetwork
                          .toDF(Seq(&quot;UserID&quot;, &quot;NrOfRetweets&quot;): _*)
                          .join(outNgbhdOfOPostUserIdinRTNetwork
                                .toDF(Seq(&quot;UserID&quot;, &quot;NrOfRetweeters&quot;): _*), &quot;UserID&quot;
                               ).orderBy($&quot;NrOfRetweets&quot;.desc)
  
  // Get user info from the &quot;primary&quot; users in our network. They are the users we've specified.
  val usersInfo = TTTDF.filter($&quot;TweetType&quot;===&quot;ReTweet&quot;)
                  .select(&quot;CPostUserID&quot;, &quot;CPostUserSN&quot;, &quot;followersCount&quot;)
                  .groupBy(&quot;CPostUserID&quot;, &quot;CPostUserSN&quot;)
                  .agg(max(&quot;followersCount&quot;).as(&quot;followersCount&quot;))
                  .toDF(Seq(&quot;UserID&quot;, &quot;ScreenName&quot;, &quot;followersCount&quot;): _*)
  
  // Get the final data to visualize
  val data = usersInfo.join(tweetsAndRetweets, Seq(&quot;UserID&quot;)).distinct.toJSON.collect
  
  // CSS code
  val visualizeNetworkCSS: String = 
  s&quot;&quot;&quot;
  /*
  General styling
  */

  body {
      font-family: Sans-Serif;
      width: 100%;
      height: 100%;
      margin: 0;
      margin-bottom: 100px;
      background-color: #FFF;
      overflow: scroll;
  }

  /*
  Page content
  */

  div.start {
      text-align: center;
  }

  ul.start {
      margin-top: 0;
      display: inline-block;
      text-align: left;
  }

  div.text {
      text-align: left;
      margin-left: 19.1%;
      margin-right: 19.1%;
  }

  /*
  For visualizations
  */

  .visualization {
      display: block;
      position: relative;
      align: center;
  }

  .hidden {
      visibility: hidden;
  }

  .visible {
      visibility: visible;
  }

  .zoom {
      cursor: move;
      fill: none;
      pointer-events: fill;
  }
  
  .title {
      fill: black;
      font-family: sans-serif;
      text-anchor: middle;
      text-align: center;
      font-size: 1.5em;
  }

  #tweet {
      position: absolute;
      z-index: 100;
      left: 80%;
      height: auto;
  }
  &quot;&quot;&quot;;
  
  // JavaScript code
  val visualizeNetworkJS: String = 
  s&quot;&quot;&quot;
  /*******************************************************************************

  This visualization is an overview of a Twitter network.

  Contained in the visualisation is, for each user:

   - Number of retweets
   - Number of individual retweeters
   - Number of followers

  *******************************************************************************/

  // TODO: Add search option

  /*
  Create accessors that specify data from the csv-file
  */
  function x(d) { return d.NrOfRetweets; }
  function y(d) { return d.NrOfRetweeters; }
  function radius(d) { return d.followersCount; }
  function color(d) { return d.followersCount; } // What to do here?
  function name(d) { return d.ScreenName; }
  function id(d) { return d.UserID; }

  /*
  Create id-functions
  */
  function getCircleId(d) { return &quot;circ&quot; + id(d); }
  function getTextId(d) { return &quot;text&quot; + id(d); }

  /*
  Specify circle constants
  */
  var circleMaxRadius = 8;
  var circleMinRadius = 3;
  var circleEnlargeConstant = 2;
  var circleIdleOpacity = 0.2;
  var circleActiveOpacity = 1;
  var circleClickedStrokeWidth = 4;

  /*
  Create svg and specify display sizes
  */
      
  // Specify display sizes.
  var width = ${width}, 
      height = ${height},
      margin = {
                top: 0.1 * height,
                right: 0.05 * width, 
                bottom: 0.1 * height,
                left: 0.05 * width
            };
            
  width = width - margin.left - margin.right;
  height = height - margin.top - margin.bottom;

  // Get div
  var div = d3.select(&quot;#treeVisualizationDiv&quot;);

  // Create svg
  var svg = div.append('svg')
      .attr(&quot;class&quot;, &quot;visualization&quot;)
      .attr('width', width + margin.left + margin.right)
      .attr('height', height + margin.top + margin.bottom)
      .append(&quot;g&quot;).attr(&quot;id&quot;, &quot;inner-space&quot;)
          .attr(&quot;transform&quot;,
              &quot;translate(&quot; + margin.left + &quot;,&quot; + margin.top + &quot;)&quot;);

  /*
  Create title
  */
  var title = svg.append(&quot;text&quot;)
      .attr(&quot;class&quot;, &quot;title&quot;) // style in css
      .attr(&quot;x&quot;, width / 2)
      .attr(&quot;y&quot;, 0)
      .text(&quot;Twitter network&quot;);

  /*
  Create x-axis
  */

  // Create x-scale
  var xScale = d3.scaleLog()
      .range([0, width]);

  // Create x-axis
  var xAxis = d3.axisBottom(xScale)
      .ticks(5, d3.format(&quot;,d&quot;))

  // Create &quot;g&quot; for displaying of x-axis
  var gXAxis = svg.append(&quot;g&quot;)
      .attr(&quot;class&quot;, &quot;x axis&quot;)
      // Position at bottom
      .attr(&quot;transform&quot;, &quot;translate(&quot; + 0 + &quot;,&quot; + height + &quot;)&quot;)

  // Create x-axis label.
  var xAxisLabel = svg.append(&quot;text&quot;)
      .attr(&quot;class&quot;, &quot;x label&quot;)
      .attr(&quot;text-anchor&quot;, &quot;end&quot;)
      .attr(&quot;x&quot;, width)
      .attr(&quot;y&quot;, height - 6)
      .text(&quot;Number of retweets&quot;);

  /*
  Create y-axis
  */

  // Create y-scale
  var yScale = d3.scaleLinear()
      .range([height, 0]);

  // Create y-axis
  var yAxis = d3.axisLeft(yScale)

  // Create &quot;g&quot; for displaying of y-axis
  var gYAxis = svg.append(&quot;g&quot;)
      .attr(&quot;class&quot;, &quot;y axis&quot;)

  // Create y-axis label
  var yAxisLabel = svg.append(&quot;text&quot;)
      .attr(&quot;class&quot;, &quot;y label&quot;)
      .attr(&quot;text-anchor&quot;, &quot;end&quot;)
      .attr(&quot;y&quot;, 6)
      .attr(&quot;dy&quot;, &quot;.75em&quot;)
      .attr(&quot;transform&quot;, &quot;rotate(-90)&quot;)
      .text(&quot;Number of unique retweeters&quot;);


  /*
  Create scale for radius
  */
  var radiusScale = d3.scaleLog()
      .base(10)
      .range([circleMinRadius, circleMaxRadius])

  /*
  Create scale for color
  */
  var colorScale = d3.scaleLinear()
      .range([&quot;blue&quot;, &quot;red&quot;])

  /*
  Create zoom
  */
  var zoom = d3.zoom()
      .scaleExtent([0.5, Infinity])
      .on(&quot;zoom&quot;, zoomed);

  // Create zoomable area
  var zoomView = svg.append(&quot;rect&quot;)
      .attr(&quot;class&quot;, &quot;zoom&quot;)
      .attr(&quot;width&quot;, width)
      .attr(&quot;height&quot;, height)
      .call(zoom)
      .on(&quot;click&quot;, clickView)

  // Add data. Each row represented as a &quot;g&quot; of class &quot;node&quot; inside the svg.
  var data = ${data.mkString(&quot;[&quot;, &quot;,\n&quot;, &quot;]&quot;)};

  xScale.domain([1, getMaxX(data)])
  gXAxis.call(xAxis)
  yScale.domain([0, getMaxY(data)])
  gYAxis.call(yAxis)
  radiusScale.domain([1, getMaxRadius(data)])
  colorScale.domain([1, getMaxColor(data)])

  // Enter the data
  var nodes = svg.append(&quot;g&quot;).selectAll(&quot;g&quot;)
      .data(data)
      .enter()

  // Create circles to display the data
  nodes.append(&quot;circle&quot;)
      .call(setCircleAttributes)
      .call(setCircleMouseEvents)
      .sort(orderLargestBelow)
  // Create tooltip that shows username
  nodes.append(&quot;text&quot;)
      .call(setTextAttributes)

  /**
   * Set attributes for circles (Twitter account nodes).
   */
  function setCircleAttributes(circle) {
      circle
          .attr(&quot;class&quot;, &quot;nodeCircle&quot;)
          .attr(&quot;data-id&quot;, id)
          .attr(&quot;id&quot;, getCircleId)
          .attr(&quot;opacity&quot;, circleIdleOpacity)
          .attr(&quot;fill&quot;, function(d) { return colorScale(color(d)); })
          .attr(&quot;stroke&quot;, &quot;black&quot;)
          .attr(&quot;stroke-width&quot;, 0)
          .attr(&quot;r&quot;, function(d) { return radiusScale(radius(d)); })
          .attr(&quot;cx&quot;, function(d) { return xScale(x(d)); })
          .attr(&quot;cy&quot;, function(d) { return yScale(y(d)); })
  }

  /**
   * Set mouse events for circles.
   */
  function setCircleMouseEvents(circle) {
      circle
          // Add tooltip and enlarge circle on mouse hover
          .on(&quot;mouseover&quot;, mouseoverCircle)
          // Remove tooltip and restore circle on mouseout
          .on(&quot;mouseout&quot;, mouseoutCircle)
          // Display timeline on click
          .on(&quot;click&quot;, clickCircle)
  }

  /**
   * Set attributes for tooltip (showing screen name) text.
   */
  function setTextAttributes(text) {
      text
          .attr(&quot;class&quot;, &quot;hidden nodeText&quot;) // Set class to hidden upon creation
          .attr(&quot;data-id&quot;, id)
          .attr(&quot;id&quot;, getTextId)
          .attr(&quot;x&quot;, function(d) { return xScale(x(d)); })
          .attr(&quot;y&quot;, function(d) { return yScale(y(d)); })
          .attr(&quot;dy&quot;, function(d) { return - (circleMaxRadius * circleEnlargeConstant * 1.5); })
          .attr(&quot;text-anchor&quot;, &quot;beginning&quot;)
          .text(function(d) { return name(d); })
  }

  /**
   * Order so that largest circle gets placed deepest.
   */
  function orderLargestBelow(a, b) {
      return radius(b) - radius(a);
  }

  /**
   * Handle mouse hover on circle. Display circle's screen name.
   */
  function mouseoverCircle() {

      // Get circle
      var circle = d3.select(this);

      // Display activated circle
      circle.attr(&quot;r&quot;, circle.attr(&quot;r&quot;) * circleEnlargeConstant);
      circle.attr(&quot;opacity&quot;, circleActiveOpacity);

      // Set text class to visible
      svg.select(&quot;#text&quot; + circle.attr(&quot;data-id&quot;))
          .classed(&quot;hidden&quot;, false)
          .classed(&quot;visible&quot;, true)

  }

  /**
   * Handle zoom. Zoom both x-axis and y-axis.
   */
  function mouseoutCircle() {

      // Get circle
      var circle = d3.select(this);

      // Display idle circle
      circle.attr(&quot;r&quot;, circle.attr(&quot;r&quot;) / circleEnlargeConstant);
      circle.attr(&quot;opacity&quot;, circleIdleOpacity);

      // Set text class to hidden
      svg.select(&quot;#text&quot; + circle.attr(&quot;data-id&quot;))
          .classed(&quot;visible&quot;, false)
          .classed(&quot;hidden&quot;, true)

  }

  /**
   * Handle zoom. Zoom both x-axis and y-axis.
   */
  function zoomed() {

      // Create new x- and y-scale
      var new_xScale = d3.event.transform.rescaleX(xScale);
      var new_yScale = d3.event.transform.rescaleY(yScale);

      // Display new axes
      gXAxis.call(xAxis.scale(new_xScale));
      gYAxis.call(yAxis.scale(new_yScale));

      // Reposition circles
      d3.selectAll(&quot;.nodeCircle&quot;)
          .attr(&quot;cx&quot;, function(d) { return new_xScale(x(d)); })
          .attr(&quot;cy&quot;, function(d) { return new_yScale(y(d)); })
          // To force constant circle radius on zoom:
          //.attr(&quot;r&quot;, function(d) { return d3.event.transform.scale(radiusScale(radius(d))).k; })

      // Reposition texts
      d3.selectAll(&quot;.nodeText&quot;)
          .attr(&quot;x&quot;, function(d) { return new_xScale(x(d)); })
          .attr(&quot;y&quot;, function(d) { return new_yScale(y(d)); })

  };

  /**
   * Handle click on zoomable area. That is, handle click outside a node which
   * is considered a deselecting click =&gt; deselect previously clicked node
   * and remove displayed tweets.
   */
  function clickView() {

      // Remove clicked status on clicked nodes
      d3.selectAll(&quot;.clicked&quot;)
          .attr(&quot;stroke-width&quot;, &quot;0&quot;)
          .classed(&quot;clicked&quot;, false)

      // Remove timeline
      document.getElementById(&quot;tweet&quot;).innerHTML = &quot;&quot;
  }

  /**
   * Handle click on a tweet circle. Display the clicked tweet and let the tweet
   * appear selected by adding a stroke to it.
   */
  function clickCircle(d) {

      // Remove results from old click
      clickView();

      // Add stroke width and set clicked class
      d3.select(this)
          .attr(&quot;stroke-width&quot;, circleClickedStrokeWidth)
          .classed(&quot;clicked&quot;, true);

      // Display tweet
      twttr.widgets.createTimeline(
          {
              sourceType: &quot;profile&quot;,
              userId: id(d)
          },
          document.getElementById(&quot;tweet&quot;), // Tweet div
          {
              height: height
          }
      )
  }

  /**
   * Returns the largest x-value in the data.
   */
  function getMaxX(data) {

      return Math.max(...data.map(d =&gt; x(d)));
  }

  /**
   * Returns the largest y-value in the data.
   */
  function getMaxY(data) {

      return Math.max(...data.map(d =&gt; y(d)));
  }

  /**
   * Returns the largest radius in the data.
   */
  function getMaxRadius(data) {

      return Math.max(...data.map(d =&gt; radius(d)));
  }

  /**
   * Returns the &quot;largest&quot; color in the data.
   */
  function getMaxColor(data) {

      var maxColor = Math.max(...data.map(d =&gt; color(d)));
      var cutOff = 10000;

      if (maxColor &gt; cutOff) return cutOff;
      return maxColor;
  }

  &quot;&quot;&quot;
  
  // HTML code
  displayHTML(s&quot;&quot;&quot;
  &lt;!DOCTYPE html&gt;
  &lt;html lang=&quot;en&quot;&gt;

      &lt;head&gt;

          &lt;meta charset=&quot;utf-8&quot;&gt;
          &lt;meta name=&quot;author&quot; content=&quot;Olof Björck&quot;&gt;
          &lt;title&gt;Network&lt;/title&gt;

          &lt;style&gt;
            ${visualizeNetworkCSS}
          &lt;/style&gt;

      &lt;/head&gt;

      &lt;body&gt;

          &lt;div id=&quot;treeVisualizationDiv&quot; class=&quot;visualization&quot; align=&quot;center&quot;&gt;
              &lt;div id=&quot;tweet&quot;&gt;&lt;/div&gt;
          &lt;/div&gt;

          &lt;script sync src=&quot;https://platform.twitter.com/widgets.js&quot;&gt;&lt;/script&gt;
          &lt;script src=&quot;https://d3js.org/d3.v4.min.js&quot;&gt;&lt;/script&gt;
          &lt;script&gt;
            ${visualizeNetworkJS}
          &lt;/script&gt;

      &lt;/body&gt;
  &lt;/html&gt;
  &quot;&quot;&quot;)
}

// Info
println(&quot;&quot;&quot;
*** WARNING: ***

THERE IS NO SIZE CHECKING! Driver might crash as DataFrame.collect is used.
Also, the display can only handle so and so many items at once. Too large
dataset and the visualization might be very laggy or crash.

***  USAGE:  ***

visualizeNetwork(TTTDF)

****************
&quot;&quot;&quot;)
</code></pre>
<div class="output execute_result plain_result" execution_count="1">
<pre><code>*** WARNING: ***

THERE IS NO SIZE CHECKING! Driver might crash as DataFrame.collect is used.
Also, the display can only handle so and so many items at once. Too large
dataset and the visualization might be very laggy or crash.

***  USAGE:  ***

visualizeNetwork(TTTDF)

****************

import org.apache.spark.sql.DataFrame
import org.apache.spark.sql.functions._
visualizeNetwork: (TTTDF: org.apache.spark.sql.DataFrame, width: Int, height: Int)Unit
</code></pre>
</div>
</div>
<div class="cell code" execution_count="1" scrolled="false">
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../contents/000_3-sds-3-x-st/029_Viz_x_VizGraphFunction.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../contents/000_3-sds-3-x-st/029_Viz_x_VizTimelineFunction.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../contents/000_3-sds-3-x-st/029_Viz_x_VizGraphFunction.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../contents/000_3-sds-3-x-st/029_Viz_x_VizTimelineFunction.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
