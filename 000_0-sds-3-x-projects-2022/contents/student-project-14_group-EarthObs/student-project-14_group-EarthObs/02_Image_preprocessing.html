<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>02_Image_preprocessing - sds-3.x/ScaDaMaLe</title>


        <!-- Custom HTML head -->

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../scroll-mdbook-outputs.css">

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../../introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Projects</li><li class="chapter-item expanded "><a href="../../../contents/student-project-01_group-GraphOfWiki/student-project-01_group-GraphOfWiki/00_Introduction.html"><strong aria-hidden="true">1.</strong> student-project-01_group-GraphOfWiki_00_Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../contents/student-project-01_group-GraphOfWiki/student-project-01_group-GraphOfWiki/01_DataLoading_redirectsTable.html"><strong aria-hidden="true">1.1.</strong> 01_DataLoading_redirectsTable</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-01_group-GraphOfWiki/student-project-01_group-GraphOfWiki/02_DataLoading_pagesTable.html"><strong aria-hidden="true">1.2.</strong> 02_DataLoading_pagesTable</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-01_group-GraphOfWiki/student-project-01_group-GraphOfWiki/03_DataLoading_pagelinksTable.html"><strong aria-hidden="true">1.3.</strong> 03_DataLoading_pagelinksTable</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-01_group-GraphOfWiki/student-project-01_group-GraphOfWiki/04_DataLoading_categorylinksTable.html"><strong aria-hidden="true">1.4.</strong> 04_DataLoading_categorylinksTable</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-01_group-GraphOfWiki/student-project-01_group-GraphOfWiki/05_DataLoading_categoryTable.html"><strong aria-hidden="true">1.5.</strong> 05_DataLoading_categoryTable</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-01_group-GraphOfWiki/student-project-01_group-GraphOfWiki/06_redirectRemoval.html"><strong aria-hidden="true">1.6.</strong> 06_redirectRemoval</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-01_group-GraphOfWiki/student-project-01_group-GraphOfWiki/07_createArticleGraph.html"><strong aria-hidden="true">1.7.</strong> 07_createArticleGraph</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-01_group-GraphOfWiki/student-project-01_group-GraphOfWiki/08_explorationArticleGraph.html"><strong aria-hidden="true">1.8.</strong> 08_explorationArticleGraph</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-01_group-GraphOfWiki/student-project-01_group-GraphOfWiki/09_fullGraphAnalysis.html"><strong aria-hidden="true">1.9.</strong> 09_fullGraphAnalysis</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-01_group-GraphOfWiki/student-project-01_group-GraphOfWiki/10_explorativeMotifs.html"><strong aria-hidden="true">1.10.</strong> 10_explorativeMotifs</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-01_group-GraphOfWiki/student-project-01_group-GraphOfWiki/11_conclusionDiscussionAndFutureWork.html"><strong aria-hidden="true">1.11.</strong> 11_conclusionDiscussionAndFutureWork</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-01_group-GraphOfWiki/student-project-01_group-GraphOfWiki/12_gameNotebookSetup.html"><strong aria-hidden="true">1.12.</strong> 12_gameNotebookSetup</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-01_group-GraphOfWiki/student-project-01_group-GraphOfWiki/13_gameNotebook.html"><strong aria-hidden="true">1.13.</strong> 13_gameNotebook</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../../../contents/student-project-02_group-DDLOfVision/student-project-02_group-DDLOfVision/00_vqa_introduction.html"><strong aria-hidden="true">2.</strong> student-project-02_group-DDLOfVision_00_vqa_introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../contents/student-project-02_group-DDLOfVision/student-project-02_group-DDLOfVision/01_vqa_model_training.html"><strong aria-hidden="true">2.1.</strong> 01_vqa_model_training</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-02_group-DDLOfVision/student-project-02_group-DDLOfVision/02_vqa_model_inference.html"><strong aria-hidden="true">2.2.</strong> 02_vqa_model_inference</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../../../contents/student-project-03_group-WikiKG2/student-project-03_group-WikiKG2/00_ingest_data.html"><strong aria-hidden="true">3.</strong> student-project-03_group-WikiKG2_00_ingest_data</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../contents/student-project-03_group-WikiKG2/student-project-03_group-WikiKG2/01_fetch_descriptions.html"><strong aria-hidden="true">3.1.</strong> 01_fetch_descriptions</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-03_group-WikiKG2/student-project-03_group-WikiKG2/02_load_data.html"><strong aria-hidden="true">3.2.</strong> 02_load_data</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-03_group-WikiKG2/student-project-03_group-WikiKG2/03_data_exploration.html"><strong aria-hidden="true">3.3.</strong> 03_data_exploration</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-03_group-WikiKG2/student-project-03_group-WikiKG2/04_analysing_relation_types.html"><strong aria-hidden="true">3.4.</strong> 04_analysing_relation_types</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-03_group-WikiKG2/student-project-03_group-WikiKG2/05_motif_search.html"><strong aria-hidden="true">3.5.</strong> 05_motif_search</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-03_group-WikiKG2/student-project-03_group-WikiKG2/06_produce_pagerank_vectors.html"><strong aria-hidden="true">3.6.</strong> 06_produce_pagerank_vectors</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-03_group-WikiKG2/student-project-03_group-WikiKG2/07_pagerank_for_classification.html"><strong aria-hidden="true">3.7.</strong> 07_pagerank_for_classification</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../../../contents/student-project-04_group-FedMLMedicalApp/student-project-04_group-FedMLMedicalApp/00_Notebook_Presentation.html"><strong aria-hidden="true">4.</strong> student-project-04_group-FedMLMedicalApp_00_Notebook_Presentation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../contents/student-project-04_group-FedMLMedicalApp/student-project-04_group-FedMLMedicalApp/01_BrainTumorSegmentation_Centralized_Training.html"><strong aria-hidden="true">4.1.</strong> 01_BrainTumorSegmentation_Centralized_Training</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-04_group-FedMLMedicalApp/student-project-04_group-FedMLMedicalApp/02_Federated_Learning_BrainTumorSegmentation.html"><strong aria-hidden="true">4.2.</strong> 02_Federated_Learning_BrainTumorSegmentation</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-04_group-FedMLMedicalApp/student-project-04_group-FedMLMedicalApp/data_upload_test.html"><strong aria-hidden="true">4.3.</strong> data_upload_test</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../../../contents/student-project-05_group-DistOpt/student-project-05_group-DistOpt/00_introduction.html"><strong aria-hidden="true">5.</strong> student-project-05_group-DistOpt_00_introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../contents/student-project-05_group-DistOpt/student-project-05_group-DistOpt/01_Bayesian_optimization.html"><strong aria-hidden="true">5.1.</strong> 01_Bayesian_optimization</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-05_group-DistOpt/student-project-05_group-DistOpt/02_Gaussian_processes.html"><strong aria-hidden="true">5.2.</strong> 02_Gaussian_processes</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-05_group-DistOpt/student-project-05_group-DistOpt/03_acquisition_functions.html"><strong aria-hidden="true">5.3.</strong> 03_acquisition_functions</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-05_group-DistOpt/student-project-05_group-DistOpt/04_scalable_Bayesian_optimization.html"><strong aria-hidden="true">5.4.</strong> 04_scalable_Bayesian_optimization</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-05_group-DistOpt/student-project-05_group-DistOpt/05_implementation_documentation.html"><strong aria-hidden="true">5.5.</strong> 05_implementation_documentation</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-05_group-DistOpt/student-project-05_group-DistOpt/06_our_implementation.html"><strong aria-hidden="true">5.6.</strong> 06_our_implementation</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-05_group-DistOpt/student-project-05_group-DistOpt/07_additional_code.html"><strong aria-hidden="true">5.7.</strong> 07_additional_code</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../../../contents/student-project-07_group-ExpsZerOInit/student-project-07_group-ExpsZerOInit/00_introduction_resnet.html"><strong aria-hidden="true">6.</strong> student-project-07_group-ExpsZerOInit_00_introduction_resnet</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../contents/student-project-07_group-ExpsZerOInit/student-project-07_group-ExpsZerOInit/01_transformer.html"><strong aria-hidden="true">6.1.</strong> 01_transformer</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-07_group-ExpsZerOInit/student-project-07_group-ExpsZerOInit/02_ddpm.html"><strong aria-hidden="true">6.2.</strong> 02_ddpm</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../../../contents/student-project-08_group-WikiSearch/student-project-08_group-WikiSearch/00_Introduction.html"><strong aria-hidden="true">7.</strong> student-project-08_group-WikiSearch_00_Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../contents/student-project-08_group-WikiSearch/student-project-08_group-WikiSearch/01_InputParsing.html"><strong aria-hidden="true">7.1.</strong> 01_InputParsing</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-08_group-WikiSearch/student-project-08_group-WikiSearch/02_PageRank.html"><strong aria-hidden="true">7.2.</strong> 02_PageRank</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-08_group-WikiSearch/student-project-08_group-WikiSearch/03_QuerySearch.html"><strong aria-hidden="true">7.3.</strong> 03_QuerySearch</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../../../contents/student-project-09_group-DistEnsembles/student-project-09_group-DistEnsembles/00_Introduction.html"><strong aria-hidden="true">8.</strong> student-project-09_group-DistEnsembles_00_Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../contents/student-project-09_group-DistEnsembles/student-project-09_group-DistEnsembles/01_Human_Pose_Data.html"><strong aria-hidden="true">8.1.</strong> 01_Human_Pose_Data</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-09_group-DistEnsembles/student-project-09_group-DistEnsembles/02_Ensemble_Training.html"><strong aria-hidden="true">8.2.</strong> 02_Ensemble_Training</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-09_group-DistEnsembles/student-project-09_group-DistEnsembles/03_Ensemble_Evaluation.html"><strong aria-hidden="true">8.3.</strong> 03_Ensemble_Evaluation</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-09_group-DistEnsembles/student-project-09_group-DistEnsembles/099_extra_Ensemble.html"><strong aria-hidden="true">8.4.</strong> 099_extra_Ensemble</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../../../contents/student-project-10_group-RDI/student-project-10_group-RDI/00_introduction.html"><strong aria-hidden="true">9.</strong> student-project-10_group-RDI_00_introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../contents/student-project-10_group-RDI/student-project-10_group-RDI/01_prepare_data.html"><strong aria-hidden="true">9.1.</strong> 01_prepare_data</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-10_group-RDI/student-project-10_group-RDI/02_baseline.html"><strong aria-hidden="true">9.2.</strong> 02_baseline</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-10_group-RDI/student-project-10_group-RDI/03_single_machine.html"><strong aria-hidden="true">9.3.</strong> 03_single_machine</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-10_group-RDI/student-project-10_group-RDI/04_distributed_learning.html"><strong aria-hidden="true">9.4.</strong> 04_distributed_learning</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../../../contents/student-project-11_group-CollaborativeFiltering/student-project-11_group-CollaborativeFiltering/01_Introduction.html"><strong aria-hidden="true">10.</strong> student-project-11_group-CollaborativeFiltering_01_Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../contents/student-project-11_group-CollaborativeFiltering/student-project-11_group-CollaborativeFiltering/02_AlgorithmsBeyondALS.html"><strong aria-hidden="true">10.1.</strong> 02_AlgorithmsBeyondALS</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-11_group-CollaborativeFiltering/student-project-11_group-CollaborativeFiltering/03_Implementation.html"><strong aria-hidden="true">10.2.</strong> 03_Implementation</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../../../contents/student-project-12_group-FedLearnOpt/student-project-12_group-FedLearnOpt/01_Federated_Learning_Introduction.html"><strong aria-hidden="true">11.</strong> student-project-12_group-FedLearnOpt_01_Federated_Learning_Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../contents/student-project-12_group-FedLearnOpt/student-project-12_group-FedLearnOpt/02_Horovod_Introduction.html"><strong aria-hidden="true">11.1.</strong> 02_Horovod_Introduction</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-12_group-FedLearnOpt/student-project-12_group-FedLearnOpt/03_Implementations.html"><strong aria-hidden="true">11.2.</strong> 03_Implementations</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../../../contents/student-project-13_group-DRL/student-project-13_group-DRL/00_DistributedRL.html"><strong aria-hidden="true">12.</strong> student-project-13_group-DRL_00_DistributedRL</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="../../../contents/student-project-14_group-EarthObs/student-project-14_group-EarthObs/00_Introduction.html"><strong aria-hidden="true">13.</strong> student-project-14_group-EarthObs_00_Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../contents/student-project-14_group-EarthObs/student-project-14_group-EarthObs/01_Download_data.html"><strong aria-hidden="true">13.1.</strong> 01_Download_data</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-14_group-EarthObs/student-project-14_group-EarthObs/02_Image_preprocessing.html" class="active"><strong aria-hidden="true">13.2.</strong> 02_Image_preprocessing</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-14_group-EarthObs/student-project-14_group-EarthObs/03_Model_Architecture_and_Training.html"><strong aria-hidden="true">13.3.</strong> 03_Model_Architecture_and_Training</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-14_group-EarthObs/student-project-14_group-EarthObs/04_Prediction_And_Visualisation.html"><strong aria-hidden="true">13.4.</strong> 04_Prediction_And_Visualisation</a></li><li class="chapter-item expanded "><a href="../../../contents/student-project-14_group-EarthObs/student-project-14_group-EarthObs/05_Conclusions.html"><strong aria-hidden="true">13.5.</strong> 05_Conclusions</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../../../contents/student-projects-BrIntSuSvConclusion/student-projects-BrIntSuSvConclusion/BrIntSuSv.html"><strong aria-hidden="true">14.</strong> student-projects-BrIntSuSvConclusion_BrIntSuSv</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="../../../editors.html"><strong aria-hidden="true">15.</strong> Editors</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">sds-3.x/ScaDaMaLe</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div class="cell markdown">
<h2 id="image-processing"><a class="header" href="#image-processing">Image processing</a></h2>
<p>This notebook processes the images downloaded from the copernicus-API and extracts the power plants. This is done by cropping the images (128x128) centered around the power plant coordinates and converting them to .bmp in a distributed manner.</p>
</div>
<div class="cell markdown">
<p>Function cropping and saving image centred around specified longitude and latitude. To find the location of the power plant in the image we first need to know where the photo was taken. This information is provided in an XML file provided along with the images. This file contains the eastern and western longitudes and the northern and southern latitudes. This together with the coordinates of the powerplant gives the location of it in the image. A square of ~5x5km around the power plant is cropped out, resized to 128x128 pixels, and then saved to <code>/dbfs/datasets/2022/group-project-14/cropped-par/&lt;TILE-ID&gt;</code>.</p>
<p>The files downloaded from the Sentinel API are provided according to a <a href="https://sentinels.copernicus.eu/web/sentinel/user-guides/sentinel-2-msi/data-formats">Standard Archive Format for Europe (SAFE)</a> file structure where all files but INSPIRE.xml and the R20m images has been filtered out. This function runs the image processing (sequentially) for all images (different wavelengths) for this product.</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-python">import os
import xml.etree.ElementTree as ET
import glob
import numpy as np
from PIL import Image
import pathlib
import re

def tile_id_from_SAFE(SAFE_path: str) -&gt; str:
    return SAFE_path.split(&quot;_&quot;)[5]

def crop_images(SAFE_path: str, target_directory: str, lat: float, lon: float, areaSize: float = 0.05, resolution: int = 128, ppid: str = &quot;&quot;, tile_id: str = &quot;&quot;) -&gt; None:
    '''
    SAFE_path - file path to SAFE directory
    target_directory - directory to save cropped images in
    lat - latitude of powerplant
    lon - longitude of powerplant
    areaSize - parameter to set size of cropped image around powerplant
    resolution - resolution of resized cropped image
    ppid - powerplant id
    tile_id - satellite tile id
    '''
    
    # xml file containing metainformation such as where image was taken
    tree = ET.parse(os.path.join('/dbfs' + SAFE_path, 'INSPIRE.xml')) 
    root = tree.getroot()
    
    # eastern longitude
    lon1 = float(
        root.find(&quot;.//{http://www.isotc211.org/2005/gmd}EX_GeographicBoundingBox&quot;)
        .find(&quot;{http://www.isotc211.org/2005/gmd}eastBoundLongitude&quot;)
        .find(&quot;{http://www.isotc211.org/2005/gco}Decimal&quot;).text
    )
    if lon1 &gt; 180:
        lon1 -= 360
    # western longitude
    lon2 = float(
        root.find(&quot;.//{http://www.isotc211.org/2005/gmd}EX_GeographicBoundingBox&quot;)
        .find(&quot;{http://www.isotc211.org/2005/gmd}westBoundLongitude&quot;)
        .find(&quot;{http://www.isotc211.org/2005/gco}Decimal&quot;).text
    )
    if lon2 &gt; 180:
        lon2 -= 360
        
    # northern latitude
    lat1 = float(
        root.find(&quot;.//{http://www.isotc211.org/2005/gmd}EX_GeographicBoundingBox&quot;)
        .find(&quot;{http://www.isotc211.org/2005/gmd}northBoundLatitude&quot;)
        .find(&quot;{http://www.isotc211.org/2005/gco}Decimal&quot;).text
    )
    # southern latitude
    lat2 = float(
        root.find(&quot;.//{http://www.isotc211.org/2005/gmd}EX_GeographicBoundingBox&quot;)
        .find(&quot;{http://www.isotc211.org/2005/gmd}southBoundLatitude&quot;)
        .find(&quot;{http://www.isotc211.org/2005/gco}Decimal&quot;).text
    )
    
    if lon &gt; 180:
        lon -= 360
        
    # coordinates of powerplant
    coords = [lat, lon]

    def pic_lon(x):
        return (x - lon1) / (lon2 - lon1)

    def pic_lat(x):
        return (x - lat1) / (lat2 - lat1)

    # coordinates in 'ratio' of image size
    lo = pic_lon(coords[1])
    la = pic_lat(coords[0])

    # bounding box around power plant
    d = areaSize
    bb = np.array(
        [
            [max((lo - d, 0)), max((la - d, 0))],
            [min((lo + d, 1)), max((la - d, 0))],
            [min((lo + d, 1)), min((la + d, 1))],
            [max((lo - d, 0)), min(la + d, 1)],
        ]
    )
    
    for imgfp in pathlib.Path('/dbfs' + SAFE_path).glob('**/*.jp2'):
        print(&quot;Img fp: &quot;, imgfp)
        imgname = str(imgfp).split(&quot;/&quot;)[-1]
        if &quot;_B0&quot; in imgname or &quot;_B1&quot; in imgname:
            # ignore if already cropped:
            if not os.path.isfile(&quot;/dbfs/datasets/2022/group-project-14/cropped/&quot; + os.path.join(tile_id, imgname[:-4]) + &quot;_cropped_{}.bmp&quot;.format(ppid)):
                print(&quot;Target directory: &quot;, target_directory)
                print(&quot;\Loading: &quot;, os.path.join(SAFE_path, imgfp))

                img = Image.open(os.path.join(SAFE_path, imgfp))
                bbb = np.round(bb * img.height).astype(int)
                box = (bbb[0, 0], bbb[0, 1], bbb[1, 0], bbb[2, 1])

                print(&quot;\tCropping: &quot;, imgfp)
                im3 = img.crop(box).resize((128, 128))
                print(&quot;\tSaving: &quot;, imgfp)

                # because of bug with Pillow and .jp2 images
                im3.mode = 'I'
                im3.point(lambda i:i*(1./256)).convert('L').save(os.path.join(target_directory, imgname[:-4]) + &quot;_cropped_{}.bmp&quot;.format(ppid))
            
</code></pre>
</div>
<div class="cell markdown">
<p>Lookup dictionary for power plants in tiles from table created from query to Sentinel API, as well as coordinates for powerplants.</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-python">import pyspark.pandas as pd
pp_lats_lons_df = spark.sql(&quot;SELECT Plant_Code, Longitude, Latitude FROM hive_metastore.default.Power_Plants WHERE PrimSource='coal'&quot;).to_pandas_on_spark().set_index(&quot;Plant_Code&quot;)
pp_id_tiles_df = spark.sql(&quot;SELECT Plant_Code, tile_ids FROM hive_metastore.default.power_plant_tile_ids_full&quot;).to_pandas_on_spark()

tile_id_lookup = {}
for ppid, l in pp_id_tiles_df.set_index(&quot;Plant_Code&quot;).to_dict()[&quot;tile_ids&quot;].items():
    for tileid in eval(l): 
        try:
            tile_id_lookup[tileid].append(ppid)
        except KeyError:
            tile_id_lookup[tileid] = [ppid]

tile_id_lookup
</code></pre>
</div>
<div class="cell markdown">
<p>Finding all power plants in image and calls function cropping around power plant coordinates. Calls the <code>crop_images</code> function above. This function takes one SAFE file as input along with the lookup dictionaries for powerplant locations and powerplant tiles. The <code>crop_images</code> function will then be called for every power plant found in this image (usually ~1-5 powerplants per tile).</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-python">def crop_and_move(SAFE, tile_id_lookup, pp_lats_lons_dict):
    '''
    SAFE - name of SAFE dir (not entire filepath)
    tile_id_lookup - powerplant - tile lookup dictionary
    pp_lats_lons_dict - powerplant - coordinates lookup dictionary
    '''
    
    print(&quot;Processing {}&quot;.format(SAFE))

    # Get PowerPlant from tile ID
    tile_id = tile_id_from_SAFE(os.path.join(&quot;/dbfs/datasets/2022/group-project-14/raw/&quot;, SAFE))
    print(&quot;\tTile ID: &quot;, tile_id)
    # # Create a directory for this tile if not exist
    if not os.path.exists(&quot;/dbfs/datasets/2022/group-project-14/cropped-par/&quot; + tile_id + &quot;/&quot;):
        os.mkdir(&quot;/dbfs/datasets/2022/group-project-14/cropped-par/&quot; + tile_id + &quot;/&quot;)

    power_plants = tile_id_lookup.get(tile_id)
    print(&quot;\tPower Plants: &quot;, *power_plants)

    for pp_id in power_plants:
        # Find Lat, Lon
        lon = pp_lats_lons_dict[&quot;Longitude&quot;].get(int(pp_id))
        lat = pp_lats_lons_dict[&quot;Latitude&quot;].get(int(pp_id))
        print(&quot;SAFE: &quot;, SAFE)
        crop_images(
          SAFE_path=os.path.join(&quot;/datasets/2022/group-project-14/raw/&quot;, SAFE),
            target_directory=&quot;/dbfs/datasets/2022/group-project-14/cropped-par/&quot; + tile_id + &quot;/&quot;,
            lat=lat, lon=lon, areaSize=0.05, resolution=512, ppid=pp_id,
            tile_id=tile_id)
</code></pre>
</div>
<div class="cell markdown">
<p>Rdd with SAFE file names. <code>crop_and_move</code> function is called with <code>map</code> on this rdd to run processing described above in parallel. In the two functions above everything runs sequentially, but as the number of SAFE directories is what is increasing with more data this is what is most important to run in parallel.</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-python">import os
from functools import partial
dbutils.fs.rm(&quot;file:///tmp/group-14-cropped-images-par&quot;, True)
dbutils.fs.mkdirs(&quot;file:///tmp/group-14-cropped-images-par&quot;)
p = os.listdir(&quot;/dbfs/datasets/2022/group-project-14/raw/&quot;)
p = [pp for pp in p if pp.endswith('.SAFE')]

rdd1 = sc.parallelize(p)

fn = partial(crop_and_move, tile_id_lookup=tile_id_lookup, pp_lats_lons_dict=pp_lats_lons_df.to_dict())

rdd1.map(fn).collect()
</code></pre>
</div>
<div class="cell markdown">
<p>Example of a cropped image around a power plant in six different bands. Centered around a power plant in Fairbanks North Star, Alaska, of size ~5x5km.</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-python">from PIL import Image
import matplotlib.pyplot as plt

def display_image(path, dpi=15):
    &quot;&quot;&quot; 
    Description:
        Displayes an image
    Inputs:
        path (str): File path
        dpi (int): Your monitor's pixel density
    &quot;&quot;&quot;
    img = Image.open(path)
    width, height = img.size
    plt.figure(figsize = (width/dpi,height/dpi))
    plt.imshow(img, interpolation='nearest', aspect='auto')

paths = [&quot;/dbfs/datasets/2022/group-project-14/cropped/T06WVT/T06WVT_20210417T213521_B02_20m_cropped_50711.bmp&quot;,&quot;/dbfs/datasets/2022/group-project-14/cropped/T06WVT/T06WVT_20210417T213521_B03_20m_cropped_50711.bmp&quot;,&quot;/dbfs/datasets/2022/group-project-14/cropped/T06WVT/T06WVT_20210417T213521_B05_20m_cropped_50711.bmp&quot;,&quot;/dbfs/datasets/2022/group-project-14/cropped/T06WVT/T06WVT_20210417T213521_B07_20m_cropped_50711.bmp&quot;,&quot;/dbfs/datasets/2022/group-project-14/cropped/T06WVT/T06WVT_20210417T213521_B11_20m_cropped_50711.bmp&quot;,&quot;/dbfs/datasets/2022/group-project-14/cropped/T06WVT/T06WVT_20210417T213521_B12_20m_cropped_50711.bmp&quot;]
img = Image.open(&quot;/dbfs/datasets/2022/group-project-14/cropped/T06WVT/T06WVT_20210417T213521_B02_20m_cropped_50711.bmp&quot;)
width, height = img.size
fig, axs = plt.subplots(2, 3, figsize=(width/5,height/7))
for i, p in enumerate(paths):
    r = 0 if i &lt; 3 else 1
    c = i % 3
    
    img = Image.open(p)
    axs[r,c].imshow(img, interpolation='nearest', aspect='auto')
</code></pre>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../contents/student-project-14_group-EarthObs/student-project-14_group-EarthObs/01_Download_data.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../../contents/student-project-14_group-EarthObs/student-project-14_group-EarthObs/03_Model_Architecture_and_Training.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../contents/student-project-14_group-EarthObs/student-project-14_group-EarthObs/01_Download_data.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../../contents/student-project-14_group-EarthObs/student-project-14_group-EarthObs/03_Model_Architecture_and_Training.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
