<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>006_BronzeSilverGoldArchitecture - sds-3.x/ScaDaMaLe</title>


        <!-- Custom HTML head -->

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../scroll-mdbook-outputs.css">

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../contents/001_1-sds-3-x-delta/000_DeltaLakesAndLiveTablesIntro.html">000_DeltaLakesAndLiveTablesIntro</a></li><li class="chapter-item expanded affix "><a href="../../contents/001_1-sds-3-x-delta/001_DeltaLakeTutorial.html">001_DeltaLakeTutorial</a></li><li class="chapter-item expanded affix "><a href="../../contents/001_1-sds-3-x-delta/001a_DeltaLakeTutorial.html">001a_DeltaLakeTutorial</a></li><li class="chapter-item expanded affix "><a href="../../contents/001_1-sds-3-x-delta/002_DeltaLiveTableCrashCourse.html">002_DeltaLiveTableCrashCourse</a></li><li class="chapter-item expanded affix "><a href="../../contents/001_1-sds-3-x-delta/003_SetupPipeline.html">003_SetupPipeline</a></li><li class="chapter-item expanded affix "><a href="../../contents/001_1-sds-3-x-delta/004_PythonLiveTableExample.html">004_PythonLiveTableExample</a></li><li class="chapter-item expanded affix "><a href="../../contents/001_1-sds-3-x-delta/005_SQLLiveTableExample.html">005_SQLLiveTableExample</a></li><li class="chapter-item expanded affix "><a href="../../contents/001_1-sds-3-x-delta/006_BronzeSilverGoldArchitecture.html" class="active">006_BronzeSilverGoldArchitecture</a></li><li class="chapter-item expanded affix "><a href="../../contents/001_1-sds-3-x-delta/007_SharingData.html">007_SharingData</a></li><li class="chapter-item expanded affix "><a href="../../editors.html">Editors</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">sds-3.x/ScaDaMaLe</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div class="cell markdown">
<p>ScaDaMaLe Course <a href="https://lamastex.github.io/scalable-data-science/sds/3/x/">site</a> and <a href="https://lamastex.github.io/ScaDaMaLe/index.html">book</a></p>
</div>
<div class="cell markdown">
<p>Oskar Åsbrink (<a href="https://www.linkedin.com/in/oskar-%C3%A5sbrink-847a76231/">LinkedIn</a>), Nicolás Martín Bekier (<a href="https://www.linkedin.com/in/nicolasmartinj/">LinkedIn</a>) and Raazesh Sainudiin (<a href="https://www.linkedin.com/in/raazesh-sainudiin-45955845/">LinkedIn</a>)</p>
<p>2023, Uppsala, Sweden</p>
<p>This project was partly supported by Combient Mix AB through the Masters-level Data Science Project Course at:</p>
<p>Combient Competence Centre for Data Engineering Sciences, Department of Mathematics, Uppsala University, Uppsala, Sweden</p>
</div>
<div class="cell markdown">
<h1 id="medallion-lakehouse-architecture"><a class="header" href="#medallion-lakehouse-architecture">Medallion Lakehouse Architecture</a></h1>
<p>The <strong>Medallion Lakehouse Architecture</strong> aims to structure data quality amongst different levels. From Bronze, to Silver, and to Gold levels, data that is originally unstructured and uncleaned, is more structured and cleaned for higher-level tables. Even many examples of this type of architecture is shown with Delta Live Tables, this can just as well be implemented in any open source Lakehouse architecture, with Delta Tables in your own open source solution.</p>
<p>Reading:</p>
<ul>
<li><a href="https://docs.databricks.com/lakehouse/medallion.html#bronze">https://docs.databricks.com/lakehouse/medallion.html#bronze</a></li>
<li><a href="https://medium.com/@omarlaraqui/the-medallion-architecture-21fe878d1aca">https://medium.com/@omarlaraqui/the-medallion-architecture-21fe878d1aca</a></li>
</ul>
<p>Repository with some examples:</p>
<ul>
<li><a href="https://github.com/databricks/delta-live-tables-notebooks">https://github.com/databricks/delta-live-tables-notebooks</a></li>
</ul>
</div>
<div class="cell markdown">
<p><img src="https://www.databricks.com/wp-content/uploads/2022/03/delta-lake-medallion-architecture-2.jpeg" alt="medallion architecture" /></p>
</div>
<div class="cell markdown">
<p><img src="https://miro.medium.com/max/640/0*tNOy5w9Wvqmlg-AK" alt="Bronze layer" /></p>
<p>The <strong>Bronze Layer</strong> contains the raw data that is ingested from batch or streaming. The data in this layer can be of various formats, from different sources and preferably stored in a file store that can hold high volumes of unstructured data.</p>
<p><img src="https://miro.medium.com/max/640/0*X6b_mO0jNUqxdav7" alt="Silver layer" /></p>
<p>In the <strong>Silver Layer</strong> of the lakehouse, data is validated, prepared and cleaned for general business use. Null values are replaced, joins with lookup tables, filters etc to give data that can be trusted for analytics, machine learning and business logic.</p>
<p><img src="https://miro.medium.com/max/640/1*hY85AeQWXpLNNuuJe9U4rQ.webp" alt="Gold layer" /></p>
<p><strong>Gold Layer</strong> is refined and structured data that is ready for consumption in specific projects. It can be ready for use in Business Intelligence and Machine Learning.</p>
</div>
<div class="cell markdown">
<p>Here is a minimal code example showing the medallion architecture in Delta Live Tables, taken from the <a href="https://github.com/databricks/delta-live-tables-notebooks/blob/main/python/Wikipedia.py">Databricks Delta Live Tables notebooks repository</a>. Observe the transormations made to each of the queries defining each table.</p>
<p>For the bronze <code>clickstream_raw</code> table, data is simlpy ingested in JSON format. In the (silver) <code>clickstream_clean</code> table, bronze data is cleansed and selected to produce data that it has &quot;just enough&quot; properties for analytics and ML. Lastly, the two gold tables (<code>top_spark_referrers</code>and <code>top_pages</code>) are filtered, aggregated, sorted for &quot;project specific&quot; Business Intelligence use.</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-python">from pyspark.sql.functions import *
from pyspark.sql.types import *
import dlt

json_path = &quot;/databricks-datasets/wikipedia-datasets/data-001/clickstream/raw-uncompressed-json/2015_2_clickstream.json&quot;

# Bronze
@dlt.create_table(
  comment=&quot;The raw wikipedia click stream dataset, ingested from /databricks-datasets.&quot;,
  table_properties={
    &quot;quality&quot;: &quot;bronze&quot;
  }
)
def clickstream_raw():
    return (
    spark.read.option(&quot;inferSchema&quot;, &quot;true&quot;).json(json_path)
  )


# Silver
@dlt.create_table(
  comment=&quot;Wikipedia clickstream dataset with cleaned-up datatypes / column names and quality expectations.&quot;,
  table_properties={
    &quot;quality&quot;: &quot;silver&quot;
  }
)
@dlt.expect(&quot;valid_current_page&quot;, &quot;current_page_id IS NOT NULL AND current_page_title IS NOT NULL&quot;)
@dlt.expect_or_fail(&quot;valid_count&quot;, &quot;click_count &gt; 0&quot;)
def clickstream_clean():
    return (
        dlt.read(&quot;clickstream_raw&quot;)
          .withColumn(&quot;current_page_id&quot;, expr(&quot;CAST(curr_id AS INT)&quot;))
          .withColumn(&quot;click_count&quot;, expr(&quot;CAST(n AS INT)&quot;))
          .withColumn(&quot;previous_page_id&quot;, expr(&quot;CAST(prev_id AS INT)&quot;))
          .withColumnRenamed(&quot;curr_title&quot;, &quot;current_page_title&quot;)
          .withColumnRenamed(&quot;prev_title&quot;, &quot;previous_page_title&quot;)
          .select(&quot;current_page_id&quot;, &quot;current_page_title&quot;, &quot;click_count&quot;, &quot;previous_page_id&quot;, &quot;previous_page_title&quot;)
      )


# Gold
@dlt.create_table(
  comment=&quot;A table of the most common pages that link to the Apache Spark page.&quot;,
  table_properties={
    &quot;quality&quot;: &quot;gold&quot;  
  }  
)
def top_spark_referrers():
    return (
        dlt.read(&quot;clickstream_clean&quot;)
          .filter(expr(&quot;current_page_title == 'Apache_Spark'&quot;))
          .withColumnRenamed(&quot;previous_page_title&quot;, &quot;referrer&quot;)
          .sort(desc(&quot;click_count&quot;))
          .select(&quot;referrer&quot;, &quot;click_count&quot;)
          .limit(10)
        )


# Gold
@dlt.create_table(
  comment=&quot;A list of the top 50 pages by number of clicks.&quot;,
  table_properties={
    &quot;quality&quot;: &quot;gold&quot;  
  }  
)
def top_pages():
    return (
        dlt.read(&quot;clickstream_clean&quot;)
          .groupBy(&quot;current_page_title&quot;)
          .agg(sum(&quot;click_count&quot;).alias(&quot;total_clicks&quot;))
          .sort(desc(&quot;total_clicks&quot;))
          .limit(50)
        )
</code></pre>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../contents/001_1-sds-3-x-delta/005_SQLLiveTableExample.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../contents/001_1-sds-3-x-delta/007_SharingData.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../contents/001_1-sds-3-x-delta/005_SQLLiveTableExample.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../contents/001_1-sds-3-x-delta/007_SharingData.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
